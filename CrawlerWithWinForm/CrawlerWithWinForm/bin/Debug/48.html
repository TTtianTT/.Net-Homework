<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta name="description" content="java类的加载机制 1、什么是类的加载 类的加载指的是将类的.class文件中的二进制数据读入到内存中，将其放在运行时数据区的方法区内，然后在堆区创建一个java.lang.Class对象，用来封装" />
    <meta property="og:description" content="java类的加载机制 1、什么是类的加载 类的加载指的是将类的.class文件中的二进制数据读入到内存中，将其放在运行时数据区的方法区内，然后在堆区创建一个java.lang.Class对象，用来封装" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>jvm系列(一):java类的加载机制 - 纯洁的微笑 - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.svg" type="image/svg+xml" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=jzhy9Oyg5XODXo8F4hsEOQFzKCPYRKZCYc011rNEfQo" />
    
    <link type="text/css" rel="stylesheet" href="https://www.cnblogs.com/ityouknow/custom.css?v=7jbZdF6cCwAjNu8jhrT5RZHfkQ8=" />
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/blacklowkey/bundle-blacklowkey-mobile.min.css?v=cX_jltB7Us4Tw2n_S08_lsTU6B1YdJoNGzly3o8GZ-8" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/ityouknow/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/ityouknow/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/ityouknow/wlwmanifest.xml" />
    <script>
        var currentBlogId = 96952;
        var currentBlogApp = 'ityouknow';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'BlackLowKey';
        var visitorUserId = '';
    </script>
        <script>
            var currentPostDateAdded = '2016-06-21 01:00';
        </script>
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=fLUEwRea4WeqlJe_CLnNunLQZl_ViJFLgKpcNDuKptI"></script>
    
    
    
</head>
<body>
    <a name="top"></a>
    <div id="top_nav" class="navbar navbar-custom">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding">
                    <a href="https://www.cnblogs.com/" title="开发者的网上家园"><img src="/images/logo.svg?v=R9M0WmLAIPVydmdzE2keuvnjl-bPR7_35oHqtiBzGsM" alt="博客园Logo" /></a>
                </li>
                <li><a href="/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-sitehome')">首页</a></li>
                <li><a href="https://news.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-news')">新闻</a></li>
                <li><a href="https://q.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-q')">博问</a></li>
                <li><a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-brands')">专区</a></li>
                <li><a href="https://ing.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-ing')">闪存</a></li>
                <li><a href="https://edu.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-edu')">班级</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="text" tabindex="3" />
                        <button type="submit" id="zzk_search_button">
                            <img src="/images/aggsite/search.svg" alt="搜索" />
                        </button>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客">
                        <img id="myblog_icon" class="navbar-icon" src="/images/aggsite/myblog.svg" alt="我的博客" />
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息">
                        <img id="msg_icon" class="navbar-icon" src="/images/aggsite/message.svg?v=oS4PkibyMjZ9rGD5XAcLt99uW_s76Javy2up4dbnZNY" alt="短消息" />
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="/images/aggsite/avatar-default.svg" alt="用户头像" />
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" onclick="logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup/">注册</a>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signin/?returnUrl=https://www.cnblogs.com/">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    <div id="page_begin_html">
        <script>loadPageBeginHtml();</script>
    </div>
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/ityouknow/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/ityouknow/">keep pure, keep smile</a>
</h1>
<h2>
<br/>万事皆因忙中错，好人半自苦中来
</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/ityouknow/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/%E7%BA%AF%E6%B4%81%E7%9A%84%E5%BE%AE%E7%AC%91">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/ityouknow/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			
			<span id="stats_post_count">随笔 - 
292&nbsp; </span>
<span id="stats_article_count">文章 - 
4&nbsp; </span>
<span id="stats-comment_count">评论 - 
3277</span>

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ityouknow/p/5603287.html">
    <span>jvm系列(一):java类的加载机制</span>
    


</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
<div id="cnblogs_post_body" class="blogpost-body">
    <style>@font-face { font-family: "Times New Roman" }
@font-face { font-family: "宋体" }
@font-face { font-family: "Wingdings" }
@font-face { font-family: "Symbol" }
@font-face { font-family: "Courier New" }
@font-face { font-family: "Symbol" }
@font-face { font-family: "Courier New" }
@font-face { font-family: "Wingdings" }
@font-face { font-family: "Arial" }
@font-face { font-family: "黑体" }
@font-face { font-family: "微软雅黑" }
@font-face { font-family: "Calibri" }
@font-face { font-family: "仿宋" }
@font-face { font-family: "Arial" }
@font-face { font-family: "Arial Unicode MS" }
@font-face { font-family: "Consolas" }
@font-face { font-family: "微软雅黑" }
@list l0:level1{
mso-level-number-format:decimal;
mso-level-suffix:none;
mso-level-text:"%1、";
mso-level-tab-stop:none;
mso-level-number-position:left;
margin-left:0.0000pt;
text-indent:0.0000pt;
font-family:'Times New Roman';}
@list l1:level1{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0b7;
mso-level-tab-stop:36.0000pt;
mso-level-number-position:left;
margin-left:36.0000pt;text-indent:-18.0000pt;font-family:symbol;font-size:10.0000pt;}
@list l1:level2{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\6f;
mso-level-tab-stop:72.0000pt;
mso-level-number-position:left;
margin-left:72.0000pt;text-indent:-18.0000pt;font-family:'Courier New';font-size:10.0000pt;}
@list l1:level3{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:108.0000pt;
mso-level-number-position:left;
margin-left:108.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
@list l1:level4{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:144.0000pt;
mso-level-number-position:left;
margin-left:144.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
@list l1:level5{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:180.0000pt;
mso-level-number-position:left;
margin-left:180.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
@list l1:level6{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:216.0000pt;
mso-level-number-position:left;
margin-left:216.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
@list l1:level7{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:252.0000pt;
mso-level-number-position:left;
margin-left:252.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
@list l1:level8{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:288.0000pt;
mso-level-number-position:left;
margin-left:288.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
@list l1:level9{
mso-level-number-format:bullet;
mso-level-suffix:tab;
mso-level-text:\f0a7;
mso-level-tab-stop:324.0000pt;
mso-level-number-position:left;
margin-left:324.0000pt;text-indent:-18.0000pt;font-family:wingdings;font-size:10.0000pt;}
p.msonormal { mso-style-name: 正文; mso-style-parent: ""; margin: 0 0 0.0001pt; mso-pagination: none; text-align: justify; text-justify: inter-ideograph; font-family: calibri; mso-fareast-font-family: 宋体; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5pt; mso-font-kerning: 1.0000pt }
h1 { mso-style-name: "标题 1"; mso-style-next: 正文; margin-left: 32.55pt; mso-pagination: none; text-align: justify; text-justify: inter-ideograph; mso-outline-level: 2; font-family: 微软雅黑; font-weight: bold; font-size: 32pt; mso-font-kerning: 1.0000pt }
h2 { mso-style-name: "标题 2"; mso-style-noshow: yes; mso-style-next: 正文; margin-top: 13pt; margin-bottom: 13pt; mso-para-margin-top: 0.0000gd; mso-para-margin-bottom: 0.0000gd; page-break-after: avoid; mso-pagination: lines-together; text-align: justify; text-justify: inter-ideograph; mso-outline-level: 2; line-height: 172%; font-family: arial; mso-fareast-font-family: 黑体; mso-bidi-font-family: 'Times New Roman'; font-weight: bold; font-size: 16pt; mso-font-kerning: 1.0000pt }
h3 { mso-style-name: "标题 3"; mso-style-noshow: yes; mso-style-next: 正文; margin-top: 13pt; margin-bottom: 13pt; page-break-after: avoid; mso-pagination: lines-together; text-align: justify; text-justify: inter-ideograph; mso-outline-level: 3; line-height: 173%; font-family: calibri; mso-fareast-font-family: 宋体; mso-bidi-font-family: 'Times New Roman'; font-weight: bold; font-size: 16pt; mso-font-kerning: 1.0000pt }
 { font-family: wingdings }
 { font-family: wingdings; color: rgba(0, 0, 255, 1); text-decoration: underline; text-underline: single }
 { font-family: wingdings; font-weight: bold }
p.msobodytext { mso-style-name: 正文文本; margin: 0 0 0.0001pt; mso-pagination: none; text-align: justify; text-justify: inter-ideograph; font-family: 宋体; font-size: 32pt; mso-font-kerning: 1.0000pt }
p.p { mso-style-name: "普通\(网站\)"; margin: 5pt 0; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-pagination: none; text-align: left; font-family: calibri; mso-fareast-font-family: 宋体; mso-bidi-font-family: 'Times New Roman'; font-size: 12pt }
span.msoins { mso-style-type: export-only; mso-style-name: ""; text-decoration: underline; text-underline: single; color: rgba(0, 0, 255, 1) }
span.msodel { mso-style-type: export-only; mso-style-name: ""; text-decoration: line-through; color: rgba(255, 0, 0, 1) }
table.msonormaltable { mso-style-name: 普通表格; mso-style-parent: ""; mso-style-noshow: yes; mso-tstyle-rowband-size: 0; mso-tstyle-colband-size: 0; mso-padding-alt: 0.0000pt 5.4000pt 0.0000pt 5.4000pt; mso-para-margin: 0pt; mso-para-margin-bottom: .0001pt; mso-pagination: widow-orphan; font-family: "Times New Roman"; font-size: 10pt; mso-ansi-language: #0400; mso-fareast-language: #0400; mso-bidi-language: #0400 }
@page { mso-page-border-surround-header: no mso-page-border-surround-footer: no }
@page section0 { margin-top: 72pt margin-bottom: 72pt margin-left: 90pt margin-right: 90pt size: 595.3000pt 841.9000pt layout-grid: 15.6000pt }
div.section0 { page: section0 }</style>

<div class="Section0" style="layout-grid: 15.6pt none">
<p class="MsoNormal" style="text-align: center" align="center"><span style="font-size: 22pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">java类的加载机制</span></p>
<p class="MsoNormal" style="text-align: center" align="center">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><a name="OLE_LINK2"></a><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-bidi-font-family: arial; mso-font-kerning: 1.0000pt; mso-ascii-font-family: arial; mso-hansi-font-family: arial; mso-shading: #ffffff"><span style="mso-list: ignore">1、</span></span><strong><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-bidi-font-family: arial; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-ascii-font-family: arial; mso-hansi-font-family: arial; mso-shading: #ffffff">什么是类的加载</span></strong></p>
<p class="MsoNormal" style="text-align: left; text-indent: 24pt"><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">类的加载指的是将类的.class文件中的二进制数据读入到内存中，将其放在运行时数据区的</span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">方法区</span></strong><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">内，然后在</span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">堆区</span></strong><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">创建一个java.lang.Class对象，用来封装类在方法区内的数据结构。类的加载的最终产品是位于堆区中的Class对象，Class对象封装了类在方法区内的数据结构，并且向Java程序员提供了访问方法区内的数据结构的接口。</span></p>
<p><a href="http://images2015.cnblogs.com/blog/331425/201606/331425-20160621125940990-365229277.png"><img style="background-image: none; float: none; padding-top: 0; padding-left: 0; margin-left: auto; display: block; padding-right: 0; margin-right: auto; border-width: 0" title="wps5F9E.tmp" src="https://images2015.cnblogs.com/blog/331425/201606/331425-20160621125941772-1913742708.png" alt="wps5F9E.tmp" width="419" height="183" border="0"></a></p>
<p class="MsoNormal" style="text-align: left; text-indent: 24pt"><a name="OLE_LINK3"></a><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">类加载器并不需要等到某个类被“首次主动使用”时再加载它，JVM规范允许类加载器在预料某个类将要被使用时就预先加载它，如果在预先加载的过程中遇到了.class文件缺失或存在错误，类加载器必须在程序首次主动使用该类时才报告错误（LinkageError错误）如果这个类一直没有被程序主动使用，那么类加载器就不会报告错误</span></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 0, 1)">加载.class文件的方式
– 从本地系统中直接加载
– 通过网络下载.class文件
– 从zip，jar等归档文件中加载.class文件
– 从专有数据库中提取.class文件
– 将Java源文件动态编译为.class文件</span></pre>
</div>
<p class="MsoNormal" style="text-align: left">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><a name="OLE_LINK7"></a><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-shading: #ffffff"><span style="mso-list: ignore">2、</span></span><strong><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">类的生命周期</span></strong></p>
<p><a href="http://images2015.cnblogs.com/blog/331425/201606/331425-20160621125942490-979409578.png"><img style="padding-top: 0; padding-left: 0; display: block; padding-right: 0; border-width: 0; margin-left: auto; margin-right: auto; background-image: none" title="wps257C.tmp" src="https://images2015.cnblogs.com/blog/331425/201606/331425-20160621125943209-1443333281.png" alt="wps257C.tmp" width="664" height="216" border="0"></a></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21.75pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">其中类加载的过程包括了</span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(255, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">加载、验证、准备、解析、初始化</span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">五个阶段。在这五个阶段中，加载、验证、准备和初始化这四个阶段发生的顺序是确定的，而解析阶段则不一定，它在某些情况下可以在初始化阶段之后开始，这是为了支持Java语言的运行时绑定（也成为动态绑定或晚期绑定）。另外注意这里的几个阶段是按顺序开始，而不是按顺序进行或完成，因为这些阶段通常都是互相交叉地混合进行的，通常在一个阶段执行的过程中调用或激活另一个阶段。</span></p>
<p class="MsoBodyText" style="margin-left: 5.55pt; text-autospace: ideograph-numeric; mso-pagination: none"><a name="OLE_LINK6"></a><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">•</span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">加载</span></strong><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：查找并加载类的二进制数据</span></p>
<p class="MsoNormal" style="margin-left: 0; text-indent: 0; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp; </span><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">加载时类加载过程的第一个阶段，在加载阶段，虚拟机需要完成以下三件事情：</span></p>
<p class="MsoNormal" style="margin-left: 0; text-indent: 0; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 10.5pt; font-family: 仿宋; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">1、通过一个类的全限定名来获取其定义的二进制字节流。</span></p>
<p class="MsoNormal" style="margin-left: 0; text-indent: 0; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; 2、将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。</span></p>
<p class="MsoNormal" style="margin-left: 0; text-indent: 0; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; 3、在Java堆中生成一个代表这个类的java.lang.Class对象，作为对方法区中这些数据的访问入口。</span></p>
<p class="MsoNormal" style="margin-left: 0; text-indent: 0; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; 相对于类加载的其他阶段而言，加载阶段（准确地说，是加载阶段获取类的二进制字节流的动作）是可控性最强的阶段，因为开发人员既可以使用系统提供的类加载器来完成加载，也可以自定义自己的类加载器来完成加载。</span></p>
<p class="MsoNormal" style="margin-left: 0; text-indent: 0; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; 加载阶段完成后，虚拟机外部的 二进制字节流就按照虚拟机所需的格式存储在方法区之中，而且在Java堆中也创建一个java.lang.Class类的对象，这样便可以通过该对象访问方法区中的这些数据。</span></p>
<p class="MsoBodyText" style="margin-left: 5.55pt; text-autospace: ideograph-numeric; mso-pagination: none"><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">•</span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">连接</span></strong></p>
<p class="MsoNormal" style="text-align: left; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none"><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;</span><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">–</span><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;</span><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">验证</span><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：确保被加载的类的正确性</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">验证是连接阶段的第一步，这一阶段的目的是为了确保Class文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。验证阶段大致会完成4个阶段的检验动作：</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><strong><span style="font-size: 10.5pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">文件格式验证</span></strong><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：验证字节流是否符合Class文件格式的规范；例如：是否以0xCAFEBABE开头、主次版本号是否在当前虚拟机的处理范围之内、常量池中的常量是否有不被支持的类型。</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><strong><span style="font-size: 10.5pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">元数据验证</span></strong><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：对字节码描述的信息进行语义分析（注意：对比javac编译阶段的语义分析），以保证其描述的信息符合Java语言规范的要求；例如：这个类是否有父类，除了java.lang.Object之外。</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><strong><span style="font-size: 10.5pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">字节码验证</span></strong><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的。</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><strong><span style="font-size: 10.5pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">符号引用验证</span></strong><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：确保解析动作能正确执行。</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">验证阶段是非常重要的，但不是必须的，它对程序运行期没有影响，如果所引用的类经过反复验证，那么可以考虑采用-Xverifynone参数来关闭大部分的类验证措施，以缩短虚拟机类加载的时间。</span></p>
<p class="MsoNormal" style="text-align: left; margin-left: 0; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: left; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none"><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;</span><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">– 准备</span><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：为类的</span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; color: rgba(255, 0, 0, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">静态变量</span></strong><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">分配内存，并将其初始化为默认值</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 宋体; mso-bidi-font-family: 'Times New Roman'; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-ascii-font-family: calibri; mso-hansi-font-family: calibri">&nbsp;</span><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp; 准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些内存都将在方法区中分配。对于该阶段有以下几点需要注意：</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; 1、这时候进行内存分配的仅包括类变量（static），而不包括实例变量，实例变量会在对象实例化时随着对象一块分配在Java堆中。</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp;&nbsp; 2、这里所设置的初始值通常情况下是数据类型默认的零值（如0、0L、null、false等），而不是被在Java代码中被显式地赋予的值。</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp; 假设一个类变量的定义为：public static int value = 3；</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp; 那么变量value在准备阶段过后的初始值为0，而不是3，因为这时候尚未开始执行任何Java方法，而把value赋值为3的putstatic指令是在程序编译后，存放于类构造器&lt;clinit&gt;（）方法之中的，所以把value赋值为3的动作将在初始化阶段才会执行。</span></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 0, 1)">· 这里还需要注意如下几点：
· 对基本数据类型来说，对于类变量（static）和全局变量，如果不显式地对其赋值而直接使用，则系统会为其赋予默认的零值，而对于局部变量来说，在使用前必须显式地为其赋值，否则编译时不通过。
· 对于同时被static和final修饰的常量，必须在声明的时候就为其显式地赋值，否则编译时不通过；而只被final修饰的常量则既可以在声明时显式地为其赋值，也可以在类初始化时显式地为其赋值，总之，在使用前必须为其显式地赋值，系统不会为其赋予默认零值。
· 对于引用数据类型reference来说，如数组引用、对象引用等，如果没有对其进行显式地赋值而直接使用，系统都会为其赋予默认的零值，即null。
· 如果在数组初始化时没有对数组中的各元素赋值，那么其中的元素将根据对应的数据类型而被赋予默认的零值。</span></pre>
</div>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;</span><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp; </span><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">3、如果类字段的字段属性表中存在ConstantValue属性，即同时被final和static修饰，那么在准备阶段变量value就会被初始化为ConstValue属性所指定的值。</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp; 假设上面的类变量value被定义为： public static final int value = 3；</span></p>
<p class="MsoNormal"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;&nbsp; 编译时Javac将会为value生成ConstantValue属性，在准备阶段虚拟机就会根据ConstantValue的设置将value赋值为3。回忆上一篇博文中对象被动引用的第2个例子，便是这种情况。我们可以理解为static final常量在编译期就将其结果放入了调用它的类的常量池中</span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal" style="text-align: left; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none"><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;</span><span style="font-size: 12pt; font-family: 宋体; color: rgba(51, 204, 51, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">– 解析</span><span style="font-size: 12pt; font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">：</span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; color: rgba(255, 0, 0, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">把类中的符号引用转换为直接引用</span></strong></p>
<p class="MsoNormal" style="text-indent: 21pt; mso-char-indent-count: 0.0000"><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程，解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符7类符号引用进行。</span><strong><span style="font-size: 10.5pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">符号引用</span></strong><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">就是一组符号来描述目标，可以是任何字面量</span><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">。</span></p>
<p class="MsoNormal"><strong><span style="font-size: 10.5pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">直接引用</span></strong><span style="font-size: 10.5pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。</span></p>
<h1 style="margin-left: 0; text-autospace: ideograph-numeric; margin-right: 18.65pt; text-indent: 0; mso-pagination: none; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 宋体; font-weight: normal; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">•<a name="OLE_LINK12"></a></span><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">初始化</span></strong></h1>
<p class="MsoNormal" style="text-align: left"><strong><span style="font-size: 12pt; font-family: 宋体; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">&nbsp;</span></strong><span style="font-size: 12pt; font-family: 宋体; font-weight: normal; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">初始化，为类的静态变量赋予正确的初始值，JVM负责对类进行初始化，主要对类变量进行初始化。</span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">在Java中对类变量进行初始值设定有两种方式：</span></p>
<p class="MsoNormal" style="text-align: left"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp; </span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">①声明类变量是指定初始<a name="OLE_LINK4"></a>值</span></p>
<p class="MsoNormal" style="text-align: left"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp; </span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">②使用静态代码块为类变量指定初始</span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">值</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp;</span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">JVM初始化步骤</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp;</span><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">1、假如这个类还没有被加载和连接，则程序先加载并连接该类</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp;</span><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">2、假如该类的直接父类还没有被初始化，则先初始化其直接父类</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp;</span><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">3、假如类中有初始化语句，则系统依次执行这些初始化语句</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-family: 宋体"><span><span style="font-size: large">类初始化时机</span></span><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">：只有当对类的主动使用的时候才会导致类的初始化，类的主动使用包括以下六种：</span></span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 创建类的实例，也就是new的方式</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 访问某个类或接口的静态变量，或者对该静态变量赋值</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 调用类的静态方法</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 反射（如Class.forName(“com.shengsiyuan.Test”)）</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 初始化某个类的子类，则其父类也会被初始化</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– Java虚拟机启动时被标明为启动类的类（Java Test），直接使用java.exe命令来运行某个主类</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><strong><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">结束生命周期</span></strong></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">•在如下几种情况下，Java虚拟机将<a name="OLE_LINK14"></a>结束生命周期</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 执行了System.exit()方法</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 程序正常执行结束</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 程序在执行过程中遇到了异常或错误而异常终止</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">– 由于操作系统出现错误而导致Java虚拟机进程终止</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><a name="OLE_LINK9"></a><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-shading: #ffffff"><span style="mso-list: ignore">3、</span></span><strong><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">类加载器</span></strong></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><a name="OLE_LINK8"></a><strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">寻找类加载器，</span></strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">先来一个小例子</span></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 255, 1)">package</span><span style="color: rgba(0, 0, 0, 1)"> com.neo.classloader;
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> ClassLoaderTest {
     </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> main(String[] args) {
        ClassLoader loader </span>=<span style="color: rgba(0, 0, 0, 1)"> Thread.currentThread().getContextClassLoader();
        System.out.println(loader);
        System.out.println(loader.getParent());
        System.out.println(loader.getParent().getParent());
    }
}</span></pre>
</div>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">运行后，输出结果：</span></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 0, 1)"><a href="mailto:sun.misc.Launcher$AppClassLoader@64fef26asun.misc.Launcher$ExtClassLoader@1ddd40f3null">sun.misc.Launcher$AppClassLoader@64fef26a
sun.misc.Launcher$ExtClassLoader@1ddd40f3
</a></span><span style="color: rgba(0, 0, 255, 1)">null</span></pre>
</div>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">从上面的结果可以看出，并没有获取到ExtClassLoader的父Loader，原因是Bootstrap Loader（引导类加载器）是用C语言实现的，找不到一个确定的返回父Loader的方式，于是就返回null。</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><span style="font-size: 10.5pt; font-family: 微软雅黑; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">这几种类加载器的层次关系如下图所示：</span></p>
<p><a href="http://images2015.cnblogs.com/blog/331425/201606/331425-20160621125943787-249179344.jpg"><img style="background-image: none; float: none; padding-top: 0; padding-left: 0; margin-left: auto; display: block; padding-right: 0; margin-right: auto; border-width: 0" title="wpsC239.tmp" src="https://images2015.cnblogs.com/blog/331425/201606/331425-20160621125944459-1013316302.jpg" alt="wpsC239.tmp" width="386" height="384" border="0"></a></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><strong><span class="16" style="font-size: 10.5pt; font-family: 微软雅黑; text-transform: none; font-weight: bold; color: rgba(68, 68, 68, 1); font-style: normal; letter-spacing: 0; mso-spacerun: 'yes'">注意：这里父类加载器并不是通过继承关系来实现的，而是采用组合实现的。</span></strong></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">站在Java虚拟机的角度来讲，只存在两种不同的类加载器：</span><strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">启动类加载器</span></strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">：它使用C++实现（这里仅限于Hotspot，也就是JDK1.5之后默认的虚拟机，有很多其他的虚拟机是用Java语言实现的），是虚拟机自身的一部分</span><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">；</span><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">所有其他的类加载器：这些类加载器都由Java语言实现，独立于虚拟机之外，并且全部继承自抽象类java.lang.ClassLoader，这些类加载器需要由启动类加载器加载到内存中之后才能去加载其他的类。</span></p>
<p class="p" style="background: rgba(255, 255, 255, 1); text-align: left; margin: 5pt 0; text-autospace: ideograph-numeric; text-indent: 0; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-para-margin-right: 0.0000gd"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">站在Java开发人员的角度来看，类加载器可以大致划分为以下三类：</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">启动类加载器</span></strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">：Bootstrap ClassLoader，负责加载存放在JDK\jre\lib(JDK代表JDK的安装目录，下同)下，或被-Xbootclasspath参数指定的路径中的，并且能被虚拟机识别的类库（如rt.jar，所有的java.*开头的类均被Bootstrap ClassLoader加载）。启动类加载器是无法被Java程序直接引用的。</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">扩展类加载器</span></strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">：Extension ClassLoader，该加载器由sun.misc.Launcher$ExtClassLoader实现，它负责加载DK\jre\lib\ext目录中，或者由java.ext.dirs系统变量指定的路径中的所有类库（如javax.*开头的类），开发者可以直接使用扩展类加载器。</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">应用程序类加载器</span></strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">：Application ClassLoader，该类加载器由sun.misc.Launcher$AppClassLoader来实现，它负责加载用户类路径（ClassPath）所指定的类，开发者可以直接使用该类加载器，如果应用程序中没有自定义过自己的类加载器，一般情况下这个就是程序中默认的类加载器。</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">应用程序都是由这三种类加载器互相配合进行加载的，如果有必要，我们还可以加入自定义的类加载器。因为JVM自带的ClassLoader只是懂得从本地文件系统加载标准的java class文件，因此如果编写了自己的ClassLoader，便可以做到如下几点：</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">1）在执行非置信代码之前，自动验证数字签名。</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">2）动态地创建符合用户特定需要的定制化构建类。</span></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">3）从特定的场所取得java class，例如数据库中和网络中。</span></p>
<p class="MsoNormal" style="text-align: left">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd" align="justify"><a name="OLE_LINK5"></a><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">JVM类加载机制</span></strong></p>
<p class="MsoNormal" style="text-align: left"><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">•</span></strong><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">全盘负责</span></strong><span style="font-size: 12pt; font-family: 仿宋; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">，当一个类加载器负责加载某个Class时，该Class所依赖的和引用的其他Class也将由该类加载器负责载入，除非显示使用另外一个类加载器来载入</span></p>
<p class="MsoNormal" style="text-align: left"><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">•</span></strong><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">父类委托</span></strong><span style="font-size: 12pt; font-family: 仿宋; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">，先让父类加载器试图加载该类，只有在父类加载器无法加载该类时才尝试从自己的类路径中加载该类</span></p>
<p class="MsoNormal" style="text-align: left"><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">•</span></strong><strong><span style="font-size: 12pt; font-family: 仿宋; font-weight: bold; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">缓存机制</span></strong><span style="font-size: 12pt; font-family: 仿宋; color: rgba(0, 176, 240, 1); mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">，缓存机制将会保证所有加载过的Class都会被缓存，当程序中需要使用某个Class时，类加载器先从缓存区寻找该Class，只有缓存区不存在，系统才会读取该类对应的二进制数据，并将其转换成Class对象，存入缓存区。这就是为什么修改了Class后，必须重启JVM，程序的修改才会生效</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-shading: #ffffff"><span style="mso-list: ignore">4、</span></span><strong><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">类的加载</span></strong></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">类加载有三种方式：</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">1、命令行启动应用时候由JVM初始化加载</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">2、通过Class.forName()方法动态加载</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">3、通过ClassLoader.loadClass()方法动态加载</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">例子：</span></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 255, 1)">package</span><span style="color: rgba(0, 0, 0, 1)"> com.neo.classloader;
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> loaderTest { 
        </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">void</span> main(String[] args) <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> ClassNotFoundException { 
                ClassLoader loader </span>= HelloWorld.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">.getClassLoader(); 
                System.out.println(loader); 
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">使用ClassLoader.loadClass()来加载类，不会执行初始化块 </span>
                loader.loadClass("Test2"<span style="color: rgba(0, 0, 0, 1)">); 
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">使用Class.forName()来加载类，默认会执行初始化块 
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">                Class.forName("Test2"); 
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">使用Class.forName()来加载类，并指定ClassLoader，初始化时不执行静态块 
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">                Class.forName("Test2", false, loader); </span>
<span style="color: rgba(0, 0, 0, 1)">        } 
}</span></pre>
</div>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">demo类</p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Test2 { 
        </span><span style="color: rgba(0, 0, 255, 1)">static</span><span style="color: rgba(0, 0, 0, 1)"> { 
                System.out.println(</span>"静态初始化块执行了！"<span style="color: rgba(0, 0, 0, 1)">); 
        } 
}</span></pre>
</div>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">分别切换加载方式，会有不同的输出结果。</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><strong><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">Class.forName()和ClassLoader.loadClass()区别</span></strong></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">Class.forName()：将类的.class文件加载到jvm中之外，还会对类进行解释，执行类中的static块；</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">ClassLoader.loadClass()：只干一件事情，就是将.class文件加载到jvm中，不会执行static中的内容,只有在newInstance才会去执行static块。</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(255, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">注</span></strong><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">：</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">Class.forName(name, initialize, loader)带参函数也可控制是否加载static块。并且只有调用了newInstance()方法采用调用构造函数，创建类的对象 。</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-shading: #ffffff"><span style="mso-list: ignore">5、</span></span><strong><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">双亲委派模型</span></strong></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 21pt; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000" align="justify"><a name="OLE_LINK10"></a><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">双亲委派模型的工作流程是：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把请求委托给父加载器去完成，依次向上，因此，所有的类加载请求最终都应该被传递到顶层的启动类加载器中，只有当父加载器在它的搜索范围中没有找到所需的类时，即无法完成该加载，子加载器才会尝试自己去加载该类。</span></p>
<h2 style="text-align: left; margin-left: 0; line-height: 22.5pt; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: widow-orphan; mso-outline-level: 2; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; font-weight: normal; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">双亲委派机制:</span></h2>
<p class="MsoNormal"><span style="font-size: 12pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">1、当AppClassLoader加载一个class时，它首先不会自己去尝试加载这个类，而是把类加载请求委派给父类加载器ExtClassLoader去完成。</span></p>
<p class="MsoNormal"><span style="font-size: 12pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">2、当ExtClassLoader加载一个class时，它首先也不会自己去尝试加载这个类，而是把类加载请求委派给BootStrapClassLoader去完成。</span></p>
<p class="MsoNormal"><span style="font-size: 12pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">3、如果BootStrapClassLoader加载失败（例如在$JAVA_HOME/jre/lib里未查找到该class），会使用ExtClassLoader来尝试加载；</span></p>
<p class="MsoNormal"><span style="font-size: 12pt; font-family: 仿宋; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'">4、若ExtClassLoader也加载失败，则会使用AppClassLoader来加载，如果AppClassLoader也加载失败，则会报出异常ClassNotFoundException。</span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><strong><span class="16" style="font-size: 10.5pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-spacerun: 'yes'; mso-shading: #ffffff">ClassLoader源码分析：</span></strong></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> Class&lt;?&gt; loadClass(String name)<span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> ClassNotFoundException {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span> loadClass(name, <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">);
    }
    
    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">synchronized</span> Class&lt;?&gt; loadClass(String name, <span style="color: rgba(0, 0, 255, 1)">boolean</span> resolve)<span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> ClassNotFoundException {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 首先判断该类型是否已经被加载</span>
            Class c =<span style="color: rgba(0, 0, 0, 1)"> findLoadedClass(name);
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (c == <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">如果没有被加载，就委托给父类加载或者委派给启动类加载器加载</span>
                <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
                    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (parent != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
                         </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">如果存在父类加载器，就委派给父类加载器加载</span>
                        c = parent.loadClass(name, <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">);
                    } </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> {
                    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">如果不存在父类加载器，就检查是否是由启动类加载器加载的类，通过调用本地方法native Class findBootstrapClass(String name)</span>
                        c =<span style="color: rgba(0, 0, 0, 1)"> findBootstrapClass0(name);
                    }
                } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (ClassNotFoundException e) {
                 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 如果父类加载器和启动类加载器都不能完成加载任务，才调用自身的加载功能</span>
                    c =<span style="color: rgba(0, 0, 0, 1)"> findClass(name);
                }
            }
            </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (resolve) {
                resolveClass(c);
            }
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> c;
        }</span></pre>
</div>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff"><strong>双亲委派模型意义</strong>：</span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><a name="OLE_LINK11"></a><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">-系统类防止内存中出现多份同样的字节码 </span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(54, 46, 43, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">-保证Java程序安全稳定运行</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-shading: #ffffff"><span style="mso-list: ignore">6、</span></span><strong><span style="font-size: 14pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: bold; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">自定义类加载器</span></strong></p>
<p class="MsoNormal" style="text-align: justify; margin-left: 0; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; text-indent: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd; mso-para-margin-left: 0.0000gd; mso-char-indent-count: 0.0000; mso-list: l0 level1 lfo1" align="justify"><span style="font-size: 12pt; font-family: 宋体; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(51, 51, 51, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 0.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">&nbsp;&nbsp;&nbsp; 通常情况下，我们都是直接使用系统类加载器。但是，有的时候，我们也需要自定义类加载器。比如应用是通过网络来传输 Java 类的字节码，为保证安全性，这些字节码经过了加密处理，这时系统类加载器就无法对其进行加载，这样则需要自定义类加载器来实现。自定义类加载器一般都是继承自 ClassLoader 类，从上面对 loadClass 方法来分析来看，我们只需要重写 findClass 方法即可。下面我们通过一个示例来演示自定义类加载器的流程：</span></p>
<div class="cnblogs_code" style="background-color: rgba(245, 245, 245, 1); border: 1px solid rgba(204, 204, 204, 1); padding: 5px">
<pre><span style="color: rgba(0, 0, 255, 1)">package</span><span style="color: rgba(0, 0, 0, 1)"> com.neo.classloader;

</span><span style="color: rgba(0, 0, 255, 1)">import</span> java.io.*<span style="color: rgba(0, 0, 0, 1)">;


</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span> MyClassLoader <span style="color: rgba(0, 0, 255, 1)">extends</span><span style="color: rgba(0, 0, 0, 1)"> ClassLoader {

    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> String root;

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> Class&lt;?&gt; findClass(String name) <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> ClassNotFoundException {
        </span><span style="color: rgba(0, 0, 255, 1)">byte</span>[] classData =<span style="color: rgba(0, 0, 0, 1)"> loadClassData(name);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (classData == <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ClassNotFoundException();
        } </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span> defineClass(name, classData, 0<span style="color: rgba(0, 0, 0, 1)">, classData.length);
        }
    }

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">byte</span><span style="color: rgba(0, 0, 0, 1)">[] loadClassData(String className) {
        String fileName </span>= root +<span style="color: rgba(0, 0, 0, 1)"> File.separatorChar
                </span>+ className.replace('.', File.separatorChar) + ".class"<span style="color: rgba(0, 0, 0, 1)">;
        </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
            InputStream ins </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> FileInputStream(fileName);
            ByteArrayOutputStream baos </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ByteArrayOutputStream();
            </span><span style="color: rgba(0, 0, 255, 1)">int</span> bufferSize = 1024<span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">byte</span>[] buffer = <span style="color: rgba(0, 0, 255, 1)">new</span> <span style="color: rgba(0, 0, 255, 1)">byte</span><span style="color: rgba(0, 0, 0, 1)">[bufferSize];
            </span><span style="color: rgba(0, 0, 255, 1)">int</span> length = 0<span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">while</span> ((length = ins.read(buffer)) != -1<span style="color: rgba(0, 0, 0, 1)">) {
                baos.write(buffer, </span>0<span style="color: rgba(0, 0, 0, 1)">, length);
            }
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> baos.toByteArray();
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (IOException e) {
            e.printStackTrace();
        }
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String getRoot() {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> root;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> setRoot(String root) {
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.root =<span style="color: rgba(0, 0, 0, 1)"> root;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> main(String[] args)  {

        MyClassLoader classLoader </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> MyClassLoader();
        classLoader.setRoot(</span>"E:\\temp"<span style="color: rgba(0, 0, 0, 1)">);

        Class</span>&lt;?&gt; testClass = <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">;
        </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
            testClass </span>= classLoader.loadClass("com.neo.classloader.Test2"<span style="color: rgba(0, 0, 0, 1)">);
            Object object </span>=<span style="color: rgba(0, 0, 0, 1)"> testClass.newInstance();
            System.out.println(object.getClass().getClassLoader());
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (ClassNotFoundException e) {
            e.printStackTrace();
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (InstantiationException e) {
            e.printStackTrace();
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (IllegalAccessException e) {
            e.printStackTrace();
        }
    }
}</span></pre>
</div>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 10.5pt; font-family: arial; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-fareast-font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">自定义类加载器的核心在于对字节码文件的获取，如果是加密的字节码则需要在该类中对文件进行解密。由于这里只是演示，我并未对<span style="font-family: Arial">class</span><span style="font-family: 宋体">文件进行加密，因此没有解密的过程。这里有几点需要注意：</span></span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 10.5pt; font-family: arial; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-fareast-font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">1<span style="font-family: 宋体">、这里传递的文件名需要是类的全限定性名称，即</span><span style="font-family: Arial">com.paddx.test.classloading.Test</span><span style="font-family: 宋体">格式的，因为 </span><span style="font-family: Arial">defineClass </span><span style="font-family: 宋体">方法是按这种格式进行处理的。</span></span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 10.5pt; font-family: arial; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-fareast-font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">2<span style="font-family: 宋体">、最好不要重写</span><span style="font-family: Arial">loadClass</span><span style="font-family: 宋体">方法，因为这样容易破坏双亲委托模式。</span></span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify"><span style="font-size: 10.5pt; font-family: arial; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 0, 1); font-style: normal; letter-spacing: 0; mso-fareast-font-family: 宋体; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">3<span style="font-family: 宋体">、这类</span><span style="font-family: Arial">Test </span><span style="font-family: 宋体">类本身可以被 </span><span style="font-family: Arial">AppClassLoader </span><span style="font-family: 宋体">类加载，因此我们不能把 </span><span style="font-family: Arial">com/paddx/test/classloading/Test.class </span><span style="font-family: 宋体">放在类路径下。否则，由于双亲委托机制的存在，会直接导致该类由 </span><span style="font-family: Arial">AppClassLoader </span><span style="font-family: 宋体">加载，而不会通过我们自定义类加载器来加载。</span></span></p>
<p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; line-height: 150%; text-autospace: ideograph-numeric; margin-right: 0; mso-pagination: none; mso-para-margin-right: 0.0000gd" align="justify">&nbsp;</p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span style="font-size: 12pt; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(44, 44, 44, 1); font-style: normal; letter-spacing: 0; mso-font-kerning: 1.0000pt; mso-spacerun: 'yes'; mso-shading: #ffffff">参考：</span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span><a href="http://blog.csdn.net/ns_code/article/details/17881581"><span style="text-decoration: underline"><span class="15" style="font-size: 12pt; text-decoration: underline; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 255, 1); font-style: normal; letter-spacing: 0; text-underline: single; mso-spacerun: 'yes'; mso-shading: #ffffff">http://blog.csdn.net/ns_code/article/details/17881581</span></span><span style="text-decoration: underline"><span class="15" style="font-size: 12pt; text-decoration: underline; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 255, 1); font-style: normal; letter-spacing: 0; text-underline: single; mso-spacerun: 'yes'; mso-shading: #ffffff"><br></span></span></a></span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span><a href="https://segmentfault.com/a/1190000005608960"><span style="text-decoration: underline"><span class="15" style="font-size: 12pt; text-decoration: underline; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 255, 1); font-style: normal; letter-spacing: 0; text-underline: single; mso-spacerun: 'yes'; mso-shading: #ffffff">https://segmentfault.com/a/1190000005608960</span></span></a></span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span><a href="http://www.importnew.com/18548.html"><span style="text-decoration: underline"><span class="15" style="font-size: 12pt; text-decoration: underline; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 255, 1); font-style: normal; letter-spacing: 0; text-underline: single; mso-spacerun: 'yes'; mso-shading: #ffffff">http://www.importnew.com/18548.html</span></span></a></span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span><a href="http://zyjustin9.iteye.com/blog/2092131"><span style="text-decoration: underline"><span class="15" style="font-size: 12pt; text-decoration: underline; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 255, 1); font-style: normal; letter-spacing: 0; text-underline: single; mso-spacerun: 'yes'; mso-shading: #ffffff">http://zyjustin9.iteye.com/blog/2092131</span></span></a></span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000"><span><a href="http://www.codeceo.com/article/java-class-loader-learn.html"><span style="text-decoration: underline"><span class="15" style="font-size: 12pt; text-decoration: underline; font-family: 仿宋; background: rgba(255, 255, 255, 1); text-transform: none; font-weight: normal; color: rgba(0, 0, 255, 1); font-style: normal; letter-spacing: 0; text-underline: single; mso-spacerun: 'yes'; mso-shading: #ffffff">http://www.codeceo.com/article/java-class-loader-learn.html</span></span></a></span></p>
<p class="MsoNormal" style="text-align: left; text-indent: 0; mso-char-indent-count: 0.0000">&nbsp;</p>




</div>
<p style="text-align: center">&nbsp;<img src="https://images2015.cnblogs.com/blog/331425/201705/331425-20170527112421388-1946699092.png" alt=""></p>
<p style="text-align: center">&nbsp;欢迎关注公众号纯洁的微笑，了解最新文章</p>
<p>&nbsp;</p>

</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2016-06-21 13:00</span>&nbsp;
<a href="https://www.cnblogs.com/ityouknow/">纯洁的微笑</a>&nbsp;
阅读(<span id="post_view_count">110612</span>)&nbsp;
评论(<span id="post_comment_count">28</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=5603287" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(5603287);return false;">收藏</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 96952, cb_blogApp = 'ityouknow', cb_blogUserGuid = '44ce118c-0edc-e011-8ee0-842b2b196315';
    var cb_entryId = 5603287, cb_entryCreatedDate = '2016-06-21 13:00', cb_postType = 1;
    loadViewCount(cb_entryId);
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id='div-gpt-ad-1592365906576-0' style='width: 300px; height: 250px;'></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id='div-gpt-ad-1592366332455-0' style='width: 468px; height: 60px;'></div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverT2();
        deliverC1C2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

<div id="sidebar_ad"></div>
			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2020 纯洁的微笑
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    <div id="page_end_html">
        <script type="text/javascript" language="javascript">
　　//Setting ico for cnblogs
　　var linkObject = document.createElement('link');
　　linkObject.rel = "shortcut icon";
　　linkObject.href = "https://files.cnblogs.com/files/ityouknow/www.ico.la_cb00753c7c82f4271f95fd0a046c4a80_128X128.ico";
　　document.getElementsByTagName("head")[0].appendChild(linkObject);
</script>

 <div style="display:none">
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254128672'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1254128672%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f3eec5dcdc379af693ff6a448b027d4e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</div>
    </div>
</body>
</html>
