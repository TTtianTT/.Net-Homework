<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="never" />
    <meta name="description" content="这是一个系列的文章，打算把Redis的基础数据结构、高级数据结构、持久化的方式以及高可用的方式都讲一遍，公众号会比其他的平台提前更新，感兴趣的可以提前关注，「SH的全栈笔记」，下面开始正文。 如果你是" />
    <meta property="og:description" content="这是一个系列的文章，打算把Redis的基础数据结构、高级数据结构、持久化的方式以及高可用的方式都讲一遍，公众号会比其他的平台提前更新，感兴趣的可以提前关注，「SH的全栈笔记」，下面开始正文。 如果你是" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Redis基础——剖析基础数据结构及其用法 - detectiveHLH - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.svg" type="image/svg+xml" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=kXxbcm7tkkASG2_xwyD6Kw4CzHe0bT3mi0jyCb8YspQ" />
    <link id="MainCss" rel="stylesheet" href="/skins/codinglife/bundle-codinglife.min.css?v=dij5UHLPkhCwoV5SpUeOW7BnKC0vZ5-8GYi-drRcxLA" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/codinglife/bundle-codinglife-mobile.min.css?v=JtOonyglmq10yOLdtvmh-WsVtFwm8HRB8mR_g_TGArQ" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/detectiveHLH/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/detectiveHLH/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/detectiveHLH/wlwmanifest.xml" />
    <script>
        var currentBlogId = 352751;
        var currentBlogApp = 'detectiveHLH';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'CodingLife';
        var visitorUserId = '';
    </script>
        <script>
            var currentPostDateAdded = '2020-10-21 04:04';
        </script>
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=kKx3DBtpvO8r97BzPmHJseQ10fGHkI-ZwMh4FA0eEd0"></script>
    
    
    
</head>
<body class="has-navbar">
    <a name="top"></a> 
    <div id="top_nav" class="navbar">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding">
                    <a href="https://www.cnblogs.com/" title="开发者的网上家园"><img src="/images/logo.svg?v=R9M0WmLAIPVydmdzE2keuvnjl-bPR7_35oHqtiBzGsM" alt="博客园Logo" /></a>
                </li>
                <li><a href="/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-sitehome')">首页</a></li>
                <li><a href="https://news.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-news')">新闻</a></li>
                <li><a href="https://q.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-q')">博问</a></li>
                <li><a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-brands')">专区</a></li>
                <li><a href="https://ing.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-ing')">闪存</a></li>
                <li><a href="https://edu.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-edu')">班级</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="text" tabindex="3" />
                        <button type="submit" id="zzk_search_button">
                            <img src="/images/aggsite/search.svg" alt="搜索" />
                        </button>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客">
                        <img id="myblog_icon" class="navbar-icon" src="/images/aggsite/myblog.svg" alt="我的博客" />
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息">
                        <img id="msg_icon" class="navbar-icon" src="/images/aggsite/message.svg?v=oS4PkibyMjZ9rGD5XAcLt99uW_s76Javy2up4dbnZNY" alt="短消息" />
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="/images/aggsite/avatar-default.svg" alt="用户头像" />
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" onclick="logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup/">注册</a>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signin/?returnUrl=https://www.cnblogs.com/">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/detectiveHLH/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/detectiveHLH/">detectiveHLH</a>
</h1>
<h2>
Nothing is true. Everything is permitted.
</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/detectiveHLH/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/detectiveHLH">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/detectiveHLH/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			
			<span id="stats_post_count">随笔 - 
42&nbsp; </span>
<span id="stats_article_count">文章 - 
0&nbsp; </span>
<span id="stats-comment_count">评论 - 
85</span>

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/detectiveHLH/p/13852896.html">
    <span>Redis基础——剖析基础数据结构及其用法</span>
    


</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
    <section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding: 0 10px; word-spacing: 0; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; line-height: 1.6; letter-spacing: 0.034em; color: rgba(63, 63, 63, 1); font-size: 16px"><blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">这是一个系列的文章，打算把Redis的<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">基础数据结构</strong>、<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">高级数据结构</strong>、<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">持久化的方式</strong>以及<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">高可用的方式</strong>都讲一遍，公众号会比其他的平台提前更新，感兴趣的可以提前关注，「<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">SH的全栈笔记</strong>」，下面开始正文。</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">如果你是一个有经验的后端或者服务器开发，那么一定听说过Redis，其全称叫<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">Remote Dictionary Server</strong>。是由C语言编写的基于Key-Value的存储系统。说直白点就是一个<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">内存数据库</strong>，既然是内存数据库就会遇到如果服务器意外宕机造成的数据不一致的问题。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">这跟很多游戏服务器也是一样的，感兴趣的可以参考我之前的文章<a href="https://mp.weixin.qq.com/s/KIfbLfOdcKnNYgMYbrKC1Q" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">游戏服务器和Web服务器的区别</a>。其数据首先会流向内存，基于快速的内存读写来实现高性能，然后定期将内存的数据中的数据落地。Redis其实也是这么个流程，基于快速的内存读写操作，单机的Redis甚至能够扛住10万的QPS。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">Redis除了高性能之外，还拥有丰富的数据结构，支持大多数的业务场景。这也是其为什么如此受欢迎的原因之一，下面我们就来看一看Redis有哪些<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">基础数据类型</strong>，以及他们底层都是怎么实现的。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">1. 数据类型</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其基础数据类型有<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">String</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">List</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">Hash</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">Set</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">Sorted Set</code>，这些都是常用的基础数据类型，可以看到非常丰富，几乎能够满足大部分的需求了。其实还有一些高级数据结构，我们在这章里暂时先不提，只聊基础的数据结构。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">2. String</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">String可以说是最基础的数据结构了， 用法上可以直接和Java中的String挂钩，你可以把String类型用于存储某个标志位，某个计数器，甚至狠一点，序列化之后的JSON字符串都行，其单个key限制为512M。其常见的命令为<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">get</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">set</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">incr</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">decr</code> 、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">mget</code>。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">2.1 使用</span><span class="suffix" style="display: none"></span></h3>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">get</strong> 获取某个key，如果key不存在会返回空指针</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">set</strong> 给key赋值，将key设置为指定的值，如果该key之前已经有值了，那么将被新的值给覆盖</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">incr</strong> 给当前的key的值+1，如果key不存在则会先给key调用<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">set</code>赋值为0，再调用<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">incr</code>。当然如果该key的类型不能做加法运算，例如字符串，就会抛出错误</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">decr</strong> 给当前key的值-1，其余的同上</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">mget</strong> 同get，只是一次性返回多条数据，不存在的key将会返回空指针</section></li></ul>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghqeovd2x2j30ck08gmxu.jpg" alt="string相关命令" style="display: block; margin: 0 auto 25px; max-width: 100%; border-radius: 4px"><figcaption style="margin-top: 5px; text-align: center; color: rgba(136, 136, 136, 1); display: block; font-size: 12px; font-family: PingFangSC-Light">string相关命令</figcaption></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">可能大多数的人只是到用一用的地步，这也无可厚非，但是如果是作为一个对技术有追求的开发，或者说你有想近大厂的想法，一定要有刨根问底的精神。只有当你真正知道一个东西的底层原理时，你遇到问题时才能提供给你更多的思路去解决问题。接下来我们就来聊一下Redis中String底层是如何实现的。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">2.2 原理</span><span class="suffix" style="display: none"></span></h3>
<h4 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 18px; margin-top: 30px"><span class="prefix" style="display: none"></span><span class="content">2.2.1 结构</span><span class="suffix" style="display: none"></span></h4>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">我们知道Redis是用C语言写的，但是Redis却没有直接使用，而是自己实现了一个叫SDS（Simple Dynamic String）的结构来实现字符串，结构如下。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55)"><span style="display: block; background: url(&quot;https://files.mdnice.com/point.png&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; background: rgba(40, 44, 52, 1); border-radius: 5px"><span class="hljs-class" style="line-height: 26px"><span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">struct</span> <span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">sdshdr</span> {</span>
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 记录buf中已使用的字节数量</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">int</span> len;
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 记录buf中未使用的字节数量</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">int</span> <span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">free</span>;
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 字节数组，用于保存字符串</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">char</span> buf[];
<span>}
<span></span></span></span></span></span></span></span></span></code></pre>
<h4 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 18px; margin-top: 30px"><span class="prefix" style="display: none"></span><span class="content">2.2.2 优点</span><span class="suffix" style="display: none"></span></h4>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">为什么Redis要自己实现SDS而不是直接用C的字符串呢？主要是因为以下几点。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">减少获取字符串长度开销</strong> C语言中获取字符串的长度需要遍历整个字符串，直到遇到结束标志位<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">\0</code>，时间复杂度为O(n)，而SDS直接维护了长度的变量，取长度的时间复杂度为O(1)</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">避免缓冲区溢出</strong> C语言中如果往一个字节数组中塞入超过其容量的字节，那么就会造成<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">缓冲区溢出</strong>，而SDS通过维护<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">free</code>变量解决了这个问题。向buf数组中写入数据时，会先判断剩余的空间是否足够塞入新数据，如果不够，SDS就会<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">重新分配</strong>缓冲区，加大之前的缓冲区。且加大的长度等于新增的数据的长度</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">空间预分配&amp;空间惰性释放</strong> C语言中，每次修改字符串都会重新分配内存空间，如果对字符串修改了n次，那么必然会出现n次内存重新分配。而SDS由于冗余了一部分空间，优化了这个问题，将<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">必然</strong>重新分配n次变为<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">最多</strong>分配n次，而数据从buf中移除的时候，空闲出来的内存也不会马上被回收，防止新写入数据而造成内存重新分配</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">保证二进制安全</strong> C语言中，字符串遇到<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">\0</code>会被截断，而SDS不会因为数据中出现了<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">\0</code>而截断字符串，换句话说，不会因为一些特殊的字符影响实际的运算结果</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">可以结合下面的图来理解SDS。</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghqfipkagxj30u009274s.jpg" alt="图片来源于网络，侵删" style="display: block; margin: 0 auto 25px; max-width: 100%; border-radius: 4px"><figcaption style="margin-top: 5px; text-align: center; color: rgba(136, 136, 136, 1); display: block; font-size: 12px; font-family: PingFangSC-Light">图片来源于网络，侵删</figcaption></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">总结一下就是上面列表的四个小标题，为了减少获取字符串长度开销、避免缓冲区溢出、空间预分配&amp;空间惰性释放和保证二进制安全。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">3. List</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">List也是一个使用频率很高的数据结构，其设计到的命令太多了，就不像String那样一个一个演示了，感兴趣的大家可以去搜一搜。命令有lpush、lpushx、rpush、rpushx、lpop、rpop、lindex、linsert、lrange、llen、lrem、lset、ltrim、rpoplpush、brpoplpush、blpop、brpop，其都是对数组中的元素的操作。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">3.1 使用</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">List的用途我认为主要集中在以下两个方面。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<ol style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: decimal">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">当作普通列表存储数据（类似于Java的ArrayList）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">用做异步队列</section></li></ol>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">普通列表这个自然不必多说，其中存放的必然业务中需要的数据，下面来着重聊一下<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">异步队列</strong>。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">啥玩意，List还能当成队列来玩？</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">List除了能被用做队列，还能当作栈来使用。在上面介绍了很多操作List命令，当我们用<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">rpush/lpop</strong>组合命令的时候，实际上就是在使用一个队列，而当我们用<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">rpush/rpop</strong>命令组合的时候，就是在使用一个栈。lpush/rpop和lpush/lpop是同理的。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">假设我们用的是<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">rpush</strong>来生产消息，当我们的程序需要消费消息的时候，就使用<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">lpop</strong>从<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">异步队列</strong>中消费消息。但是如果采用这种方式，当队列为空时，你可能需要不停的去询问队列中是否有数据，这样会造成机器的CPU资源的浪费。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">所以你可以采取让当前线程<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">Sleep</strong>一段时间，这样的确可以节省一部分CPU资源。但是你可能就需要去考虑Sleep的时间，间隔太短，CPU<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">上下文切换</strong>可能也是一笔不小的开销，间隔太长，那么可能造成这条消息被延迟消费（不过都用异步队列了，应该可以忽略这个问题）。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">除了Sleep，还有没有其他的方式？</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">有，答案是<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">blpop</strong>。当我们使用blpop去消费时，如果当前队列是空的，那么此时线程会阻塞住，直到下面两种condition。</p>
<ol data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: decimal">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">达到设置的timeout时间</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">队列中有消息可以被消费</section></li></ol>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">比起<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">Sleep</strong>一段时间，实时性会好一点；比起轮询，对CPU资源更加友好。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">3.2 原理</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">在Redis3.2之前，Redis采用的是ZipList（压缩列表）或者LinkedList（链表）。当List中的元素<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">同时</strong>满足<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">每个元素的小于64字节</code>和<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">List元素个数小于512个</code>时，存储的方式为<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">ZipList</strong>。但凡有一个条件没满足就会转换为<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">LinkedList</strong>。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">而在3.2之后，其实现变成了QuickList（快速列表）。LinkedList由于是较为基础的东西，此处就不赘述了。</p>
<h4 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 18px; margin-top: 30px"><span class="prefix" style="display: none"></span><span class="content">3.2.1 ZipList</span><span class="suffix" style="display: none"></span></h4>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">ZipList采用连续的内存紧凑存储，不像链表那样需要有额外的空间来存储前驱节点和后续节点的指针。按照其存储的区域划分，大致可以分为三个部分，每个部分也有自己的划分，其详细的结构如下。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">header ziplist的头部信息
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: square">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">zlbytes 标识ziplist所占用的内存字节数</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">zltail 到ziplist尾节点的偏移量</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">zllen ziplist中的存储的节点数量</section></li></ul>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">entries 存储实际节点的信息
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: square">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">pre_entry_length 记录了前一个节点的长度，通过这个值可以快速的跳转到上一个节点</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">encoding 顾名思义，存储量元素的编码格式</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">length 所存储数据的长度</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">content 保存节点的内容</section></li></ul>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">end 标识ziplist的末尾</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">如果采用链表的存储方式，链表中的元素由指针相连，这样的方式可能会造成一定的<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">内存碎片</strong>。而指针也会占用额外的存储空间。而ZipList不会存在这些情况，ZipList占用的是一段连续的内存空间。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">但是相应地，ZipList的修改操作效率较为低下，插入和删除的操作会设计到频繁的内存空间申请和释放（有点类似于ArrayList重新扩容），且查询效率同样会受影响，本质上ZipList查询元素就是遍历链表。</p>
<h4 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 18px; margin-top: 30px"><span class="prefix" style="display: none"></span><span class="content">3.2.2 QuickList</span><span class="suffix" style="display: none"></span></h4>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">在3.2版本之后，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">list</code>的实现就换成了QuickList。QuickList将list分成了多个节点，每一个节点采用<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">ZipList</strong>存储数据。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">4. Hash</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其用法就跟Java中的HashMap中一样，都是往map中去丢键值对。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">4.1 使用</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">基础的命令如下：</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hset</strong> 在hash中设置键值对</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hget</strong> 获hash中的某个key值</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hdel</strong> 删除hash中某个键</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hlen</strong> 统计hash中元素的个数</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hmget</strong> 批量的获取hash中的键的值</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">hmset 批量的设置hash中的键和值</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hexists</strong> 判断hash中某个key是否存在</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hkeys</strong> 返回hash中的所有键（不包含值）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hvals</strong> 返回hash中的所有值（不包含键）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">hgetall</strong> 获取所有的键值对，包含了键和值</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其实大多数情况下的使用跟HashMap是差不多的，没有什么较为特殊的地方。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">4.2 原理</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">hash的底层实现也是有两种，ZipList和HashTable。但具体采用哪一种与Redis的版本无关，而与当前hash中所存的元素有关。首先当我们创建一个hash的时候，采用的ZipList进行存储。随着hash中的元素增多，达到了Redis设定的阈值，就会转换为HashTable。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其设定的阈值如下：</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">存储的某个键或者值长度大于默认值（64）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">ZipList中存储的元素数量大于默认值（512）</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">ZipList上面我们专门简单分析了一下，理解这个设定应该也比较容易。当ZipList中的元素过多的时候，其查询的效率就会变得低下。而HashTable的底层设计其实和Java中的<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">HashMap</strong>差不多，都是通过拉链法解决哈希冲突。具体的可以参考<a href="https://mp.weixin.qq.com/s/-ZE8eA-2CFYsgwRbwjEVnw" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">从基础的使用来深挖HashMap</a>这篇文章。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">5. Set</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">Set的概念可以与Java中的Set划等号，用于存储一个不包含重复元素的集合。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">5.1 使用</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其主要的命令如下，key代表redis中的Set，member代表集合中的元素。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sadd</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">sadd key member [...]</code> 将一个或者多个元素加入到集合中，如果有已经存在的元素会忽略掉。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">srem</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">srem key member [...]</code>将一个或者多个元素从集合中移除，不存在的元素会被忽略掉</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">smembers</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">smembers key</code>返回集合中的所有成员</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sismember</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">dismember key member</code>判断member在key中是否存在，如果存在则返回1，如果不存在则返回0</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">scard</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">scard key</code>返回集合key中的元素的数量</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">smove</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">move source destination member</code>将元素从source集合移动到destination集合。如果source中不包含member，则不会执行任何操作，当且仅当存在才会从集合中移出。如果destination已经存在元素则不会对destination做任何操作。该命令是原子操作。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">spop</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">spop key</code>随机删除并返回集合中的一个元素</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">srandmember</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">srandmember key</code>与spop一样，只不过不会将元素删除，可以理解为从集合中随机出一个元素来。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sinter</strong> 求一个或者多个集合的交集</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sinterstore</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">sinterstore destination key [...]</code>与sinter类似，但是会将得出的结果存到destination中。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sunion</strong> 求一个或者多个集合的并集</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sunionstore</strong>  <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">sunionstore destination key [...]</code></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sdiff</strong>  求一个或者多个集合的差集</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">sdiffstore</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">sdiffstore destination key [...]</code>与sdiff类似，但是会将得出的结果存到destination中。</section></li></ul>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">5.2 原理</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">我们知道Java中的Set有多种实现。在Redis中也是，有<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">IntSet</strong>和<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">HashTable</strong>两种实现，首先初始化的时候使用的是<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">IntSet</strong>，而满足如下的条件时，就会转换成<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">HashTable</strong>。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">当集合中保存的所有元素都是整数时</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">集合对象保存的元素数量不超过512</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">上面已经简单的介绍了HashTable了，所以这里只聊聊IntSet。</p>
<h4 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 18px; margin-top: 30px"><span class="prefix" style="display: none"></span><span class="content">5.2.1 IntSet</span><span class="suffix" style="display: none"></span></h4>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">intset底层是一个数组，既然数据结构是数组，那么存储数据就可以是有序的，这也使得intset的底层查询是通过二分查找来实现。其结构如下。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55)"><span style="display: block; background: url(&quot;https://files.mdnice.com/point.png&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; background: rgba(40, 44, 52, 1); border-radius: 5px"><span class="hljs-class" style="line-height: 26px"><span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">struct</span> <span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">intset</span> {</span>
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 编码方式</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">uint32_t</span> encoding;
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 集合包含元素的数量</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">uint32_t</span> length;
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 存储元素的数组</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">int8_t</span> contents[];
<span>}
<span></span></span></span></span></span></span></span></span></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">与ZipList类似，IntSet也是使用的一连串的内存空间，但是不同的是ZipList可以存储二进制的内容，而IntSet只能存储整数；且ZipList存储是无序的，IntSet则是有序的，这样一来，元素个数相同的前提下，IntSet的查询效率会更高。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">6. Sorted Set</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其与Set的功能大致类似，只不过在此基础上，可以给每一个元素赋予一个权重。你可以理解为Java的<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">TreeSet</strong>。与List、Hash、Set一样，其底层的实现也有两种，分别是<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">ZipList</strong>和<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">SkipList</strong>（跳表）。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">初始化Sorted Set的时候，会采用ZipList作为其实现，其实很好理解，这个时候元素的数量很少，采用ZipList进行紧凑的存储会更加的节省空间。当期达到如下的条件时，就会转换为SkipList：</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">其保存的元素数量的个数小于128个</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500">其保存的所有元素长度小于64字节</section></li></ul>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">6.1 使用</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">下面的命令中，key代表zset的名字；4代表score，也就是权重；而member就是zset中的key的名称。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zadd</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zadd key 4 member</code>用于增加元素</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zcard</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zcard key</code>用于获取zset中的元素的数量</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zrem</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrem key member [...]</code>删除zset中一个或者多个key</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zincrby</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zincrby key 1 member</code>给key的权重值加上score的值（也就是1）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zscore</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zscore key member</code>用于获取指定key的权重值</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zrange</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrange key 0 -1</code>获取zset中所有的元素，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrange key 0 -1 withscores</code>获取所有元素和权重，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">withscores</code>参数的作用是决定是否将权重值也一起返回。其返回的元素按照<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">从小到大</strong>排序，如果元素具有相同的权重，则会按照字典序排序。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zrevrange</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrevrange key 0 -1 withscores</code>，其与<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrange</code>类似，只不过<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrevrange</code>按照<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">从大到小</strong>排序。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">zrangebyscore</strong> <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrangebyscore key 1 5</code>，返回key中权重在区间(1, 5]范围内元素。当然也可以使用<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">withscores</code>来将权重值一并返回。其元素按照<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">从小到大</strong>排序。1代表min，5代表max，他们也可以分别是**-inf<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">和</strong>inf**，当你不知道key中的score区间时，就可以使用这个。还有一个类似于SQL中的limit的可选参数，在此就不赘述。</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">除了能够对其中的元素添加权重之外，使用ZSet还可以实现<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">延迟队列</strong>。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">延迟队列用于存放延迟任务，那什么是延迟队列呢？</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">举个很简单的例子， 你在某个电商APP中下订单，但是没有付款，此时它会提醒你，「订单如果超过1个小时没有支付，将会自动关闭」；再比如在某个活动结束前1个小时给用户推送消息；再比如订单完成后多少天自动确认收货等等。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">用人话解释一遍，那就是过会才要干的事情。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">那ZSet怎么实现这个功能？</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其实很简单，就是将任务的执行时间设置为ZSet中的元素权重，然后通过一个后台线程定时的从ZSet中查询出权重最小的元素，然后通过与当前时间戳判断，如果大于当前时间戳（也就是该执行了）就将其从ZSet中取出。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">那，怎么取？</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">其实我看很多讲Redis实现延迟队列的博客都没有把这个怎么取讲清楚，到底该用什么命令，传什么参数。我们使用<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27, 31, 35, 0.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: rgba(40, 202, 113, 1)">zrangebyscore</code>命令来实现，还记得-inf和inf吗，其全称是infinity，分别表示无限小和无限大。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">由于我们并不知道延迟队列当中的score（也就是任务执行时间）的范围，所以我们可以直接使用-inf和inf，完整命令如下。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55)"><span style="display: block; background: url(&quot;https://files.mdnice.com/point.png&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; background: rgba(40, 44, 52, 1); border-radius: 5px">zrangescore key -inf inf limt 0 1 withscores
<span></span></code></pre>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">还是有点用，那ZSet底层是咋实现的呢？</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">上面已经讲过了ZipList，就不赘述，下面聊聊SkipList。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 20px; margin-top: 1.2em"><span style="background-image: url(&quot;https://my-wechat.mdnice.com/koala-3.png&quot;); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px"></span><span class="prefix" style="display: none"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgba(72, 179, 120, 1)">6.2 原理</span><span class="suffix" style="display: none"></span></h3>
<h4 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 18px; margin-top: 30px"><span class="prefix" style="display: none"></span><span class="content">6.2.1 SkipList</span><span class="suffix" style="display: none"></span></h4>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">SkipList存在于zset（Sorted Set）的结构中，如下：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55)"><span style="display: block; background: url(&quot;https://files.mdnice.com/point.png&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; background: rgba(40, 44, 52, 1); border-radius: 5px"><span class="hljs-class" style="line-height: 26px"><span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">struct</span> <span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">zset</span> {</span>
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 字典</span>
<span>  dict *dict;
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 跳表</span>
<span>  zskiplist *zsl;
<span>}
<span></span></span></span></span></span></span></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">而SkipList的结构如下：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55)"><span style="display: block; background: url(&quot;https://files.mdnice.com/point.png&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; background: rgba(40, 44, 52, 1); border-radius: 5px"><span class="hljs-class" style="line-height: 26px"><span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">struct</span> <span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">zskiplist</span> {</span>
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 表头节点和表尾节点</span>
<span>  <span class="hljs-class" style="line-height: 26px"><span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">struct</span> <span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">zskiplistNode</span> *<span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">header</span>, *<span class="hljs-title" style="color: rgba(230, 192, 123, 1); line-height: 26px">tail</span>;</span>
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 表中节点的数量</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">unsigned</span> <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">long</span> length;
<span>  <span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">// 表中层数最大的节点的层数</span>
<span>  <span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">int</span> level;
<span>}
<span></span></span></span></span></span></span></span></span></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">不知道大家是否有想过，为什么Redis要使用SkipList来实现ZSet，而不用数组呢？</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">首先ZSet如果数组存储的话，由于ZSet中存储的元素是有序的，存入的时候需要将元素放入数组中对应的位置。这样就会对数组进行频繁的增删，而频繁的增删在数组中效率并不高，因为涉及到数组元素的移动，如果元素插入的位置是首位，那么后面的所有元素都要被移动。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">所以为了应付频繁增删的场景，我们需要使用到链表。但是随着链表的元素增多，同样的会出现问题，虽然增删的效率提升了，但是查询的效率变低了，因为查询元素会从头到尾的遍历链表。所有如果有什么方法能够提升链表的查询效率就好了。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">于是跳表就诞生了。基于单链表，从第一个节点开始，每隔一个节点，建立索引。其实也是单链表。只不是中间省略了节点。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">例如存在个单链表 1 3 4 5 7 8 9 10 13 16 17 18</p>
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">抽象之后的索引为 1    4    7     9       13      17</p>
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">如果要查询16只需要在索引层遍历到13，然后根据13存储的下层节点（真实链表节点的地址），此时只需要再遍历两个节点就可以找到值为16的节点。</p>
</blockquote>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">所以可以重新给跳表下一个定义，<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">链表加多级索引的结构，就是跳表</strong></p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">在跳表中，查询任意数据的时间复杂度是<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">O(logn)</strong>。时间复杂度跟二分查找是一样的。可以换句话说，用单链表实现了<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">二分查找</strong>。但这也是一种用<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">空间换时间</strong>的思路，并不是免费的。</p>
<h2 data-tool="mdnice编辑器" style="padding: 0; font-weight: bold; color: rgba(0, 0, 0, 1); font-size: 22px; display: block; text-align: center; background-image: url(&quot;https://my-wechat.mdnice.com/koala-2.png&quot;); background-position: center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 50px; margin-top: 1em; margin-bottom: 10px"><span class="prefix" style="display: none"></span><span class="content" style="text-align: center; display: inline-block; height: 38px; line-height: 42px; color: rgba(72, 179, 120, 1); background-position: left; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 63px; margin-top: 38px; font-size: 18px; margin-bottom: 10px">End</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgba(74, 74, 74, 1); line-height: 1.75em">关于Redis的基础数据结构和其底层的原理就简单的聊到这里，之后的几篇应该会聊聊Redis的高可用和其对应的解决方案，感兴趣的可以持续关注，公众号会比其他的平台都先更新。</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgba(53, 179, 120, 1); font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(251, 249, 253, 1); color: rgba(106, 115, 125, 1); padding: 15px 20px; margin-bottom: 20px; margin-top: 20px; line-height: 27px; display: block">
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">往期文章：</p>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: rgba(0, 0, 0, 1); list-style-type: disc">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><a href="https://mp.weixin.qq.com/s?__biz=MzU5NDk0MTc2OA==&amp;mid=2247483947&amp;idx=1&amp;sn=c49d43c5993d4a9fb4b6270df2b23187&amp;chksm=fe78c00cc90f491ae187cae966d2c8fbc0cbada1435323096b732f528b88384ed5d06a7e30aa&amp;token=792636259&amp;lang=zh_CN#rd" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">大白话聊聊微服务——人人都能看懂的演进过程</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><a href="https://mp.weixin.qq.com/s?__biz=MzU5NDk0MTc2OA==&amp;mid=2247483937&amp;idx=1&amp;sn=46ecf87cc91a1793bc930da3be367c32&amp;chksm=fe78c006c90f49101668babd92328394a6560579aaae1f6c59fa0ade187258d228e7a8867e03&amp;token=792636259&amp;lang=zh_CN#rd" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">简单了解InnoDB底层原理</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><a href="https://mp.weixin.qq.com/s?__biz=MzU5NDk0MTc2OA==&amp;mid=2247483929&amp;idx=1&amp;sn=f1ae1f212100a826cecad5c91ab05838&amp;chksm=fe78c03ec90f492881c91db36244eae13e406061b9567c0a39bb1817dde43735136c5d9f6959&amp;token=792636259&amp;lang=zh_CN#rd" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">浅谈JVM与垃圾回收</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><a href="https://mp.weixin.qq.com/s?__biz=MzU5NDk0MTc2OA==&amp;mid=2247483883&amp;idx=1&amp;sn=d1017f5a637b5963ad8d73fdc7a87829&amp;chksm=fe78c3ccc90f4ada0dae25cf7084bcf5ca5ddc3556b0a9e1ac3c0097d3d10a8fe1f87378d9f7&amp;token=792636259&amp;lang=zh_CN#rd" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">深入了解ConcurrentHashMap</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgba(1, 1, 1, 1); font-weight: 500"><a href="https://mp.weixin.qq.com/s?__biz=MzU5NDk0MTc2OA==&amp;mid=2247483843&amp;idx=1&amp;sn=74c8d0fef0aa10079eb5ae45f237b3ee&amp;chksm=fe78c3e4c90f4af287ed0a225a4c1131be5186d601542d12663cb0f45a13e2680869526c2f1c&amp;token=792636259&amp;lang=zh_CN#rd" style="word-wrap: break-word; font-weight: bold; color: rgba(72, 179, 120, 1); text-decoration: none; border-bottom: 1px solid rgba(72, 179, 120, 1)">【简单了解系列】从基础的使用来深挖HashMap</a></section></li></ul>
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">如果你觉得这篇文章对你有帮助，还麻烦<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">点个赞</strong>，<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">关个注</strong>，<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">分个享</strong>，<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">留个言</strong></p>
<p style="padding: 0; margin: 0; line-height: 26px; font-size: 15px; color: rgba(89, 89, 89, 1)">也可以微信搜索公众号【<strong style="font-weight: bold; line-height: 1.75em; color: rgba(74, 74, 74, 1)">SH的全栈笔记</strong>】，当然也可以直接扫描二维码关注</p>
<figure style="margin: 10px 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9ydcu1h1hj30by0bygme.jpg" alt="" style="display: block; margin: 0 auto 25px; max-width: 100%; border-radius: 4px"></figure>
</blockquote></section>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2020-10-21 16:04</span>&nbsp;
<a href="https://www.cnblogs.com/detectiveHLH/">detectiveHLH</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=13852896" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(13852896);return false;">收藏</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/10.3.1/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 352751, cb_blogApp = 'detectiveHLH', cb_blogUserGuid = '6d863182-a42f-e711-9fc1-ac853d9f53cc';
    var cb_entryId = 13852896, cb_entryCreatedDate = '2020-10-21 16:04', cb_postType = 1;
    loadViewCount(cb_entryId);
</script>
<a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id='div-gpt-ad-1592365906576-0' style='width: 300px; height: 250px;'></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id='div-gpt-ad-1592366332455-0' style='width: 468px; height: 60px;'></div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
       var commentManager = new blogCommentManager();
       commentManager.renderComments(0);
       fixPostBody();
       deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);       deliverT2();
       deliverC1C2();
       loadNewsAndKb();
       loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);       LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
       GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
       loadOptUnderPost();
       GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
   </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>
<div id="sidebar_ad"></div>
			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2020 detectiveHLH
<br /><span id="poweredby">Powered by .NET 5.0.0-rc.2.20475.5 on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    
</body>
</html>
