<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta name="description" content="先来看看我所虚拟的领域模型。这一次我定义了一个书店（BookStore）： 书店有自己的地址（Address）： 同时书店里放了N本书（Book）： 每本书都有出版商信息（Publisher）： 每本" />
    <meta property="og:description" content="先来看看我所虚拟的领域模型。这一次我定义了一个书店（BookStore）： 书店有自己的地址（Address）： 同时书店里放了N本书（Book）： 每本书都有出版商信息（Publisher）： 每本" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>AutoMapper小结 - 呆河马 - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.svg" type="image/svg+xml" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=jzhy9Oyg5XODXo8F4hsEOQFzKCPYRKZCYc011rNEfQo" />
    <link id="MainCss" rel="stylesheet" href="/skins/minyx2_lite/bundle-minyx2_lite.min.css?v=iIHShuhcudom5U24qlIVesUy8uDJ-S4HZBaKNMOB9lI" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/minyx2_lite/bundle-minyx2_lite-mobile.min.css?v=arJ4BmwdBcUZrSduKjIvQKPiliQ99OBUW7yasPqJtdY" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/jobs2/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/jobs2/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/jobs2/wlwmanifest.xml" />
    <script>
        var currentBlogId = 126355;
        var currentBlogApp = 'jobs2';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'Minyx2_Lite';
        var visitorUserId = '';
    </script>
        <script>
            var currentPostDateAdded = '2014-01-03 04:58';
        </script>
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=fLUEwRea4WeqlJe_CLnNunLQZl_ViJFLgKpcNDuKptI"></script>
    
    
    <script src="/skins/minyx2_lite/bundle-minyx2_lite.min.js?v=z_XLIOc5JYwRKqTPu9fAWp7D8tchhGxVWGYvlAiigUQ" type="text/javascript" language="javascript"></script>
</head>
<body>
    <a name="top"></a>
    <div id="top_nav" class="navbar">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding">
                    <a href="https://www.cnblogs.com/" title="开发者的网上家园"><img src="/images/logo.svg?v=R9M0WmLAIPVydmdzE2keuvnjl-bPR7_35oHqtiBzGsM" alt="博客园Logo" /></a>
                </li>
                <li><a href="/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-sitehome')">首页</a></li>
                <li><a href="https://news.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-news')">新闻</a></li>
                <li><a href="https://q.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-q')">博问</a></li>
                <li><a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-brands')">专区</a></li>
                <li><a href="https://ing.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-ing')">闪存</a></li>
                <li><a href="https://edu.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-edu')">班级</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="text" tabindex="3" />
                        <button type="submit" id="zzk_search_button">
                            <img src="/images/aggsite/search.svg" alt="搜索" />
                        </button>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客">
                        <img id="myblog_icon" class="navbar-icon" src="/images/aggsite/myblog.svg" alt="我的博客" />
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息">
                        <img id="msg_icon" class="navbar-icon" src="/images/aggsite/message.svg?v=oS4PkibyMjZ9rGD5XAcLt99uW_s76Javy2up4dbnZNY" alt="短消息" />
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="/images/aggsite/avatar-default.svg" alt="用户头像" />
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" onclick="logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup/">注册</a>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signin/?returnUrl=https://www.cnblogs.com/">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    
    
<div id="container">
    <a class="minyx" href="https://www.cnblogs.com/">代码改变世界</a>
    <ul id="topMnu">
        <!-- 统计数据 -->
        <li>
            Posts - 
63, 
Articles - 
1, 
Comments - 
39
<!---->


        </li>
        <!-- 这边可以增加一些链接 -->
        <!-- 博客园 -->
        <li><a href="https://www.cnblogs.com/">Cnblogs</a></li>
        <!-- 管理 -->
        <li id="topMnu-dashboard">
            <a id="lnkDashboard" href="https://i.cnblogs.com/">Dashboard</a>
        </li>
        <li>
            
    <a id="lnkLogin" href="https://account.cnblogs.com/signin/?returnUrl=https://www.cnblogs.com/jobs2/">Login</a>


        </li>
    </ul>

    <script type="text/javascript">
        var m = window.__blog.topMenuRendered;
        if (m) { m(__$("topMnu")); }
    </script>

    <div id="header">
        <ul id="menu">
            <!-- 首页，当前section加上current类 -->
            <li id="menu-home" class="current">
                <a id="lnkHome" href="https://www.cnblogs.com/jobs2/">Home</a></li>
            <!-- 联系 -->
            <li id="menu-contact">
                <a id="lnkContact" href="https://msg.cnblogs.com/send/%E5%91%86%E6%B2%B3%E9%A9%AC">Contact</a></li>
            <!-- 相册 -->
            <li id="menu-gallary">
                <a id="lnkGallery" href="https://www.cnblogs.com/jobs2/gallery.html">Gallery</a></li>
            <!-- 订阅 -->
            <li id="menu-subscribe">
                <a id="blog_nav_rss" href="javascript:void(0);" data-rss="https://www.cnblogs.com/jobs2/rss/">Subscribe</a></li>
            <!-- Rss订阅 -->
            <li id="rss">
                <a id="lnkRss" href="https://www.cnblogs.com/jobs2/rss/">RSS</a></li>
        </ul>
        <div id="newmsg"></div>
        <h1>
            <!-- 主标题 -->
            <a id="lnkBlogTitle" href="https://www.cnblogs.com/jobs2/">呆河马</a>
            <!-- 子标题 -->
            <small>
                There goes all my data.
            </small>
        </h1>
    </div>

    <script type="text/javascript">
        var m = window.__blog.headerRendered;
        if (m) { m(__$("header")); }
    </script>

    <div id="wrapper">
        <div id="content">
            <script type="text/javascript">
                var m = window.__blog.preRenderPosts;
                if (m) { m(); }
            </script>
            <div id="post_detail">
<div class="post" id="post">
    <a name="top"></a>
    <h2>
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jobs2/p/3503990.html">
    <span>AutoMapper小结</span>
    


</a>
</h2>
    <small>
<span id="post-date">2014-01-03 16:58</span>&nbsp;
<a href="https://www.cnblogs.com/jobs2/">呆河马</a>&nbsp;
阅读(<span id="post_view_count">41425</span>)&nbsp;
评论(<span id="post_comment_count">22</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=3503990" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(3503990);return false;">收藏</a></small>
    <div class="entry">
        
<div id="cnblogs_post_body" class="blogpost-body">
    <pre class="line mt-10 q-content"><span style="font-size: 16px">一些orm框架，在用到Entity的时候有一些开源代码用到了automapper（如：nopcommence），将数据对象转成DTO。比如在ORM中，与数据库交互用的Model模型是具有很多属性变量方法神马的。而当我们与其它系统（或系统中的其它结构）进行数据交互时，出于耦合性考虑或者安全性考虑或者性能考虑（总之就是各种考虑），我们不希望直接将这个Model模型传递给它们，这时我们会创建一个贫血模型来保存数据并传递。什么是贫血模型？贫血模型（DTO，Data Transfer Object）就是说只包含属性什么的，只能保存必须的数据，没有其它任何的多余的方法数据什么的，专门用于数据传递用的类型对象。在这个创建的过程中，如果我们手动来进行，就会看到这样的代码：</span></pre>
<pre class="best-text mb-10"><span style="font-size: 16px">A a=new A();</span><br><span style="font-size: 16px">a.X1=b.X1;</span><br><span style="font-size: 16px">a.X2=b.X2;</span><br><span style="font-size: 16px">...</span><br><span style="font-size: 16px">...</span><br><span style="font-size: 16px">...</span><br><span style="font-size: 16px">return a;</span></pre>
<pre class="best-text mb-10"><span style="font-size: 16px">此时，AutoMapper可以发挥的作用就是根据A的模型和B的模型中的定义，自动将A模型映射为一个全新的B模型。基于访问性的控制或从模型本身上考虑。对外开放的原则是，尽量降低系统耦合度，否则内部一旦变更外部所有的接口都要跟随发生变更；另外，系统内部的一些数据或方法并不希望外部能看到或调用。类似的考虑很多，只是举个例子。系统设计的原则是高内聚低耦合，尽量依赖抽象而不依赖于具体。这里感觉automapper就是使数据库实体对一个外部调用实体的转换更简便（不用一个属性一个属性的赋值）。</span></pre>
<pre><span style="font-size: 16px">例如1：数据库里面有用户信息表，供别的系统调用，提供了数据接口。如果直接暴露了数据库层的表结构的话，会对系统本身产生依赖。具体表现在，假定现在因为某种需要，为用户信息增加了十个字段的信息，那么，如果不进行类型映射的话，会导致所有基于此用户数据结构的模块集体挂掉（接口约定变更）。而如果使用了映射的话，我们可以在内部进行转换，保持原有接口不变并提供新的更全面的接口，这是保证系统的可维护性和可迁移性。</span><br><br><span style="font-size: 16px">例如2：一个Web应用通过前端收集用户的输入成为Dto，然后将Dto转换成领域模型并持久化到数据库中。相反，当用户请求数据时，我们又需要做相反的工作：将从数据库中查询出来的领域模型以相反的方式转换成Dto再呈现给用户。使用AutoMapper（一个强大的Object-Object Mapping工具），来实现这个转换。</span></pre>
<h5><span style="font-size: 16px">一 ，应用场景</span></h5>
<p><span style="font-size: 16px">&nbsp;先来看看我所虚拟的领域模型。这一次我定义了一个书店（BookStore）：&nbsp;</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> BookStore  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;Book&gt; Books { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> Address Address { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
<p><span>书店有自己的地址（Address）：&nbsp;</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Address  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Country { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> City { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Street { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> PostCode { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
<p><span style="font-size: 16px">同时书店里放了N本书（Book）：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Book  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Title { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Description { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Language { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">decimal</span> Price { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;Author&gt; Authors { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> DateTime? PublishDate { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> Publisher Publisher { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span>? Paperback { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
</div>
<p><span style="font-size: 16px">每本书都有出版商信息（Publisher）：&nbsp;</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Publisher  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
<p><span>每本书可以有最多2个作者的信息（Author）：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Author  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Description { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> ContactInfo ContactInfo { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
</div>
<p><span style="font-size: 16px">每个作者都有自己的联系方式（ContactInfo）：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> ContactInfo  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Email { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Blog { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Twitter { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
} </span></pre>
</div>
</div>
<p><span style="font-size: 16px">差不多就是这样了，一个有着层级结构的领域模型。&nbsp;再来看看我们的Dto结构。&nbsp;在Dto中我们有与BookStore对应的BookStoreDto：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre> <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> BookStoreDto  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;BookDto&gt; Books { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> AddressDto Address { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
</div>
<p><span style="font-size: 16px">其中包含与Address对应的AddressDto：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> AddressDto  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Country { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> City { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Street { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> PostCode { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}</span></pre>
</div>
</div>
<p><span style="font-size: 16px">以及与Book相对应的BookDto：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> BookDto  
{  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Title { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Description { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Language { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">decimal</span> Price { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> DateTime? PublishDate { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Publisher { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span>? Paperback { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> FirstAuthorName { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> FirstAuthorDescription { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> FirstAuthorEmail { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> FirstAuthorBlog { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> FirstAuthorTwitter { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> SecondAuthorName { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> SecondAuthorDescription { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> SecondAuthorEmail { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> SecondAuthorBlog { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> SecondAuthorTwitter { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }  
}  </span></pre>
</div>
</div>
<p><span style="font-size: 16px">注意到我们的BookDto”拉平了“整个Book的层级结构，一个BookDto里携带了Book及其所有Author、Publisher等所有模式的数据。</span><span style="font-size: 16px">正好我们来看一下Dto到Model的映射规则。&nbsp;</span></p>
<p><span style="font-size: 16px">（1）BookStoreDto –&gt; BookStore</span></p>
<table style="width: 400px" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">BookStoreDto中的字段</span></td>
<td valign="top" width="199"><span style="font-size: 16px">BookStore中的字段</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Name</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Name</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Books</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Books</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Address</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Address</span></td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px">（2）AddressDto –&gt; Address</span></p>
<table style="width: 400px" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">AddressDto中的字段</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Address中的字段</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Country</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Country</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">City</span></td>
<td valign="top" width="199"><span style="font-size: 16px">City</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Street</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Street</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">PostCode</span></td>
<td valign="top" width="199"><span style="font-size: 16px">PostCode</span></td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px">（3）BookDto -&gt; Book。&nbsp;</span><span style="font-size: 16px">BookDto中的一些基本字段可以直接对应到Book中的字段。</span></p>
<table style="width: 400px" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">BookDto中的字段</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Book中的字段</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Title</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Title</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Description</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Description</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Language</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Language</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Price</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Price</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">PublishDate</span></td>
<td valign="top" width="199"><span style="font-size: 16px">PublishDate</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Paperback</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Paperback</span></td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px">&nbsp;</span></p>
<p><span style="font-size: 16px">每本书至多有2个作者，在BookDto中分别使用”First“前缀和”Second“前缀的字段来表示。因此，所有FirstXXX字段都将映射成Book的Authors中的第1个Author对象，而所有SecondXXX字段则将映射成Authors中的第2个Author对象。</span></p>
<table style="width: 545px" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top" width="202"><span style="font-size: 16px">BookDto中的字段</span></td>
<td valign="top" width="341"><span style="font-size: 16px">Book中的Authors中的第1个Author对象中的字段</span></td>
</tr>
<tr>
<td valign="top" width="203"><span style="font-size: 16px">FirstAuthorName</span></td>
<td valign="top" width="340"><span style="font-size: 16px">Name</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">FirstAuthorDescription</span></td>
<td valign="top" width="340"><span style="font-size: 16px">Description</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">FirstAuthorEmail</span></td>
<td valign="top" width="340"><span style="font-size: 16px">ContactInfo.Email</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">FirstAuthorBlog</span></td>
<td valign="top" width="340"><span style="font-size: 16px">ContactInfo.Blog</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">FirstAuthorTwitter</span></td>
<td valign="top" width="340"><span style="font-size: 16px">ContactInfo.Twitter</span></td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px">注意上表中的ContactInfo.Email表示对应到Author对象的ContactInfo的Email字段，依次类推。类似的我们有：</span></p>
<table style="width: 545px" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top" width="202"><span style="font-size: 16px">BookDto中的字段</span></td>
<td valign="top" width="341"><span style="font-size: 16px">Book中的Authors中的第2个Author对象中的字段</span></td>
</tr>
<tr>
<td valign="top" width="203"><span style="font-size: 16px">SecondAuthorName</span></td>
<td valign="top" width="340"><span style="font-size: 16px">Name</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">SecondAuthorDescription</span></td>
<td valign="top" width="340"><span style="font-size: 16px">Description</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">SecondAuthorEmail</span></td>
<td valign="top" width="340"><span style="font-size: 16px">ContactInfo.Email</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">SecondAuthorBlog</span></td>
<td valign="top" width="340"><span style="font-size: 16px">ContactInfo.Blog</span></td>
</tr>
<tr>
<td valign="top" width="204"><span style="font-size: 16px">SecondAuthorTwitter</span></td>
<td valign="top" width="340"><span style="font-size: 16px">ContactInfo.Twitter</span></td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px">最后还有Publisher字段，它将对应到一个独立的Publisher对象。</span></p>
<table style="width: 400px" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">BookDto中的字段</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Publisher中的字段</span></td>
</tr>
<tr>
<td valign="top" width="199"><span style="font-size: 16px">Publisher</span></td>
<td valign="top" width="199"><span style="font-size: 16px">Name</span></td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px">差不多就是这样了，我们的需求是要实现这一大坨Dto到另一大坨的Model之间的数据转换。</span></p>
<h5><span style="font-size: 16px">二，<strong>以Convention方式实现零配置的对象映射</strong></span></h5>
<p><span style="font-size: 16px">在上一篇文章中我们构造出了完整的应用场景，包括我们的Model、Dto以及它们之间的转换规则。下面开始我们的AutoMapper之旅了。</span></p>
<div class="quote_title"><span style="font-size: 16px">引用：AutoMapper uses a convention-based matching algorithm to match up source to destination values.</span></div>
<p><span style="font-size: 16px">我们要做的只是将要映射的两个类型告诉AutoMapper（调用Mapper类的Static方法CreateMap并传入要映射的类型）：&nbsp;</span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>Mapper.CreateMap&lt;AddressDto, Address&gt;();  </pre>
</div>
</div>
<p><span style="font-size: 16px">然后就可以交给AutoMapper帮我们搞定一切了：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>AddressDto dto = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AddressDto  
{  
    Country </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">China</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,  
    City </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Beijing</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,  
    Street </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Dongzhimen Street</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,  
    PostCode </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">100001</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">  
};  
Address address </span>= Mapper.Map&lt;AddressDto,Address&gt;<span style="color: rgba(0, 0, 0, 1)">(Dto);  
address.Country.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">China</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);  
address.City.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Beijing</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);  
address.Street.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Dongzhimen Street</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);  
address.PostCode.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">100001</span><span style="color: rgba(128, 0, 0, 1)">"</span>);  </pre>
</div>
</div>
<p><span style="font-size: 16px">如果AddressDto中有值为空的属性，AutoMapper在映射的时候会把Address中的相应属性也置为空：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>Address address = Mapper.Map&lt;AddressDto,Address&gt;(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AddressDto  
{  
       Country </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">China</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">  
});  
address.City.ShouldBeNull();  
address.Street.ShouldBeNull();  
address.PostCode.ShouldBeNull();</span></pre>
</div>
</div>
<p><span style="font-size: 16px">甚至如果传入一个空的AddressDto，AutoMapper也会帮我们得到一个空的Address对象。<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>Address address = Mapper.Map&lt;AddressDto,Address&gt;(<span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">);  
address.ShouldBeNull();  </span></pre>
</div>
</div>
<p><span style="font-size: 16px">千万不要把这种Convention的映射方式当成“玩具”，它在映射具有相同字段名的复杂类型的时候还是具有相当大的威力的。&nbsp;</span><br><span style="font-size: 16px">例如，考虑我们的BookStoreDto到BookStore的映射，两者的字段名称完全相同，只是字段的类型不一致。如果我们定义好了BookDto到Book的映射规则，再加上上述Convention方式的AddressDto到Address的映射，就可以用“零配置”实现BookStoreDto到BookStore的映射了：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>IMappingExpression&lt;BookDto, Book&gt; expression = Mapper.CreateMap&lt;BookDto,Book&gt;<span style="color: rgba(0, 0, 0, 1)">();  
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Define mapping rules from BookDto to Book here  </span>
Mapper.CreateMap&lt;AddressDto, Address&gt;<span style="color: rgba(0, 0, 0, 1)">();  
Mapper.CreateMap</span>&lt;BookStoreDto, BookStore&gt;();  </pre>
</div>
</div>
<p><span style="font-size: 16px">然后我们就可以直接转换BookStoreDto了：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>BookStoreDto dto = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> BookStoreDto  
{  
    Name </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">My Store</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,  
    Address </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AddressDto  
    {  
        City </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Beijing</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">  
    },  
    Books </span>= <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;BookDto&gt;<span style="color: rgba(0, 0, 0, 1)">  
    {  
        </span><span style="color: rgba(0, 0, 255, 1)">new</span> BookDto {Title = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">RESTful Web Service</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">},  
        </span><span style="color: rgba(0, 0, 255, 1)">new</span> BookDto {Title = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Ruby for Rails</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">},  
    }  
};  
BookStore bookStore </span>= Mapper.Map&lt;BookStoreDto,BookStore&gt;<span style="color: rgba(0, 0, 0, 1)">(dto);  
bookStore.Name.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">My Store</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);  
bookStore.Address.City.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Beijing</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);  
bookStore.Books.Count.ShouldEqual(</span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">);  
bookStore.Books.First().Title.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">RESTful Web Service</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);  
bookStore.Books.Last().Title.ShouldEqual(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Ruby for Rails</span><span style="color: rgba(128, 0, 0, 1)">"</span>);  </pre>
</div>
</div>
<div class="csharpcode">
<p><span style="font-size: 16px">实现BookDto到Book之间的转换（他嵌套了相应的子类型如：Publisher -&gt;ContactInfo,Author）：</span></p>
<div class="csharpcode">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> exp = Mapper.CreateMap&lt;BookDto, Book&gt;<span style="color: rgba(0, 0, 0, 1)">();
exp.ForMember(bok</span>=&gt; bok.Publisher<span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">(变量)</span><span style="color: rgba(0, 128, 0, 1)">*/</span><span style="color: rgba(0, 0, 0, 1)">,
(map) </span>=&gt; map.MapFrom(dto=&gt;<span style="color: rgba(0, 0, 255, 1)">new</span> Publisher(){Name= dto.Publisher<span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">(DTO的变量)</span><span style="color: rgba(0, 128, 0, 1)">*/</span>}));</pre>
</div>
</div>
<pre><span style="font-size: 16px">一般在我们写完规则之后通常会调用，该方法主要用来检查还有那些规则没有写完。</span></pre>
<div class="cnblogs_code">
<pre>Mapper.AssertConfigurationIsValid();</pre>
</div>
<p><span style="color: rgba(0, 0, 0, 1); font-family: Consolas; font-size: 16px">参见：<a href="http://stackoverflow.com/questions/4928487/how-to-automap-thismapping-sub-members">http://stackoverflow.com/questions/4928487/how-to-automap-thismapping-sub-members</a></span></p>
<p><span style="color: rgba(0, 0, 0, 1); font-family: Consolas; font-size: 16px">其它的就以此类推。</span></p>
<p><span style="font-size: 16px">如果要完成 BookStore 到 BookStoreDto 具体的应该如何映射呢？</span><br><span style="font-size: 16px">相同的类型与名字就不说了，如BookStore.Name-&gt;BookStoreDto.Name AutoMapper会自动去找。</span><span style="font-size: 16px">而对于List&lt;Book&gt;与List&lt;BookDto&gt;者我们必须在配置下面代码之前</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> exp = Mapper.CreateMap&lt;BookStore, BookStoreDto&gt;<span style="color: rgba(0, 0, 0, 1)">();
exp.ForMember(dto </span>=&gt; dto.Books, (map) =&gt; map.MapFrom(m =&gt; m.Books));</pre>
</div>
<p><span style="font-size: 16px">告诉AutoMapper，Book与BookDto的映射，最后效果为:</span></p>
<div class="cnblogs_code">
<pre>Mapper.CreateMap&lt;Book, BookDto&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> exp = Mapper.CreateMap&lt;BookStore, BookStoreDto&gt;<span style="color: rgba(0, 0, 0, 1)">();
exp.ForMember(dto </span>=&gt; dto.Books, (map) =&gt; map.MapFrom(m =&gt; m.Books));</pre>
</div>
<p><span style="font-size: 16px">Address同理。</span><span style="font-size: 16px">如果要完成不同类型之间的转换用AutoMapper，如string到int,string-&gt;DateTime,以及A-&gt;B之间的类型转换我们可以参照如下例子：</span></p>
<p><span style="font-size: 16px"><a href="http://automapper.codeplex.com/wikipage?title=Custom%20Type%20Converters&amp;referringTitle=Home">http://automapper.codeplex.com/wikipage?title=Custom%20Type%20Converters&amp;referringTitle=Home</a></span></p>
<p><span style="font-size: 16px">对于我们不想要某属性有值我们可以采用下面的方式。</span></p>
<div class="csharpcode">
<div class="cnblogs_code">
<pre>exp.ForMember(ads =&gt; ads.ZipCode, dto =&gt; dto.Ignore()); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">如果对于不想某属性有值，我们可以通过Ignore来忽略他，这样在调用AssertConfigurationIsValid时也不会报错.</span></pre>
</div>
<p>&nbsp;</p>
</div>
<p><strong><span><span style="font-size: 16px"><strong>三，定义类型间的简单映射规则</strong>&nbsp;</span><br></span></strong><span style="font-size: 16px">前面我们看了Convention的映射方式，客观的说还是有很多类型间的映射是无法通过简单的Convention方式来做的，这时候就需要我们使用Configuration了。好在我们的Configuration是在代码中以“强类型”的方式来写的，比写繁琐易错的xml方式是要好的多了。&nbsp;先来看看BookDto到Publisher的映射。&nbsp;回顾一下前文中定义的规则：BookDto.Publisher -&gt; Publisher.Name。&nbsp;在AutoMapperzhong,我们可以这样映射：</span><strong><span><span>&nbsp;</span></span></strong></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> map = Mapper.CreateMap&lt;BookDto,Publisher&gt;<span style="color: rgba(0, 0, 0, 1)">();  
map.ForMember(d </span>=&gt; d.Name, opt =&gt; opt.MapFrom(s =&gt; s.Publisher));  </pre>
</div>
</div>
<p><span style="font-size: 16px">AutoMapper使用ForMember来指定每一个字段的映射规则：<strong>&nbsp;<br></strong></span></p>
<div class="quote_title"><span style="font-size: 16px">引用：The each custom member configuration uses an action delegate to configure each member.</span></div>
<p><span style="font-size: 16px">还好有强大的lambda表达式，规则的定义简单明了。&nbsp;此外，我们还可以使用ConstructUsing的方式一次直接定义好所有字段的映射规则。例如我们要定义BookDto到第一作者（Author）的ContactInfo的映射，使用ConstructUsing方式，我们可以：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> map = Mapper.CreateMap&lt;BookDto,ContactInfo&gt;<span style="color: rgba(0, 0, 0, 1)">();  
map.ConstructUsing(s </span>=&gt; <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ContactInfo  
{  
        Blog </span>=<span style="color: rgba(0, 0, 0, 1)"> s.FirstAuthorBlog,  
        Email </span>=<span style="color: rgba(0, 0, 0, 1)"> s.FirstAuthorEmail,  
        Twitter </span>=<span style="color: rgba(0, 0, 0, 1)"> s.FirstAuthorTwitter  
});  </span></pre>
</div>
</div>
<p><span style="font-size: 16px">然后，就可以按照我们熟悉的方式来使用了：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre>BookDto dto = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> BookDto  
{  
      FirstAuthorEmail </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">matt.rogen@abc.com</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,  
       FirstAuthorBlog </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">matt.amazon.com</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,  
};  
ContactInfo contactInfo </span>= Mapper.Map&lt;BookDto, ContactInfo&gt;(dto);  </pre>
</div>
</div>
<p><span style="font-size: 16px">如果需要映射的2个类型有部分字段名称相同，又有部分字段名称不同呢？还好AutoMapper给我们提供的Convention或Configuration方式并不是“异或的”，我们可以结合使用两种方式，为名称不同的字段配置映射规则，而对于名称相同的字段则忽略配置。&nbsp;</span><br><span style="font-size: 16px">例如：对于前面提到的AddressDto到Address的映射，假如AddressDto的字段Country不叫Country叫CountryName，那么在写AddressDto到Address的映射规则时，只需要：<strong>&nbsp;</strong></span></p>
<div id="" class="dp-highlighter">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> map = Mapper.CreateMap&lt;AddressDto, Address&gt;<span style="color: rgba(0, 0, 0, 1)">();  
map.ForMember(d </span>=&gt; d.Country, opt =&gt; opt.MapFrom(s =&gt; s.CountryName));  </pre>
</div>
</div>
<p><span style="font-size: 16px">对于City、Street和PostCode无需定义任何规则，AutoMapper仍然可以帮我们进行正确的映射。</span></p>
</div>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
        <div class="clear"></div>
        <div id="blog_post_info_block">
        <div id="blog_post_info">
        </div>
        <div class="clear"></div>
        <div id="post_next_prev"></div>
    </div>
</div>
    <ul class="postmetadata">
        

<li class="icon_bullet" id="EntryTag">
&nbsp;</li>
    </ul>
</div>
<script type="text/javascript">
    var m = window.__blog.postRendered;
    if (m) { m(__$("post")); }
</script>
<script type="text/javascript">
    var m = window.__blog.postRenderPosts;
    if (m) { m(); }
</script>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 126355, cb_blogApp = 'jobs2', cb_blogUserGuid = 'bede93a6-caee-e111-aa3f-842b2b196315';
    var cb_entryId = 3503990, cb_entryCreatedDate = '2014-01-03 16:58', cb_postType = 1;
    loadViewCount(cb_entryId);
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id='div-gpt-ad-1592365906576-0' style='width: 300px; height: 250px;'></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id='div-gpt-ad-1592366332455-0' style='width: 468px; height: 60px;'></div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverT2();
        deliverC1C2();
        loadNewsAndKb();
        loadBlogSignature();
        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div></div>


        </div>

        <script type="text/javascript">
            var m = window.__blog.contentRendered;
            if (m) { m(__$("content")); }
        </script>

        <div id="sidebar">
            <div id="about">
                <div>
                    <h2 id="about_title">About</h2>
                    <div id="about_body">
                        <div id="sidebar_news"></div>
                        <script type="text/javascript">loadBlogNews();</script>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                var m = window.__blog.aboutRendered;
                if (m) { m(__$("about")); }
            </script>
            <div id="mySearchWrapper">
                <div id="mySearch">
                    <input type="image" src="/skins/minyx2_lite/images/btnsearch.gif" id="btnZzk"  class="submit" onclick="zzk_go();return false;"/>
                    <label class="lb_search"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="keyword" /></label>
                </div>
            </div>
            <script type="text/javascript">
                var m = window.__blog.searchFormRendered;
                if (m) { m(__$("searchform")); }
            </script>
            <div id="sideMain">
            </div>
            <div id="sideRight">
            </div>
            <div id="sideLeft">
            </div>            
                <div id="sideContainer">
                </div>
                <script type="text/javascript">
                    $.ajax({
                        url: '/' + currentBlogApp + '/ajax/Minyx2_Lite_SideColumn.aspx',
                        data: '{}',
                        type: 'post',
                        dataType: 'text',
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            if (data) {
                                $("#sideContainer").html(data);
                                $.ajax({
                                    url: getAjaxBaseUrl() + 'TopLists.aspx',
                                    type: 'get',
                                    dataType: 'text',
                                    success: function (topLists) {
                                        if (topLists) {
                                            $("#sideContainer").append(topLists);
                                        }
                                        var m = window.__blog.sideContainerRendered;
                                        if (m) { m(__$("sideContainer")); }
                                        window.__blog.sidebar.__layout();
                                    }
                                });
                            }
                        }
                    });

                </script>
        </div>

        <script type="text/javascript">
            var m = window.__blog.sidebarRendered;
            if (m) { m(__$("sidebar")); }
        </script>

        <div id="footer">
            <p id="logoFoot">
    <a href="http://www.spiga.com.mx/" title="Agencia Interactiva Spiga">www.spiga.com.mx</a>
</p>
<div class="footText">
<p>
Copyright &copy; 2020 呆河马
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>

</p>
<p>
<a href="http://www.cnblogs.com">博客园</a>
</p>
</div>


        </div>
    </div>

    <script type="text/javascript">
        var m = window.__blog.wrapperRendered;
        if (m) { m(__$("wrapper")); }
    </script>

</div>
<script type="text/javascript">
    var m = window.__blog.containerRendered;
    if (m) { m(__$("container")); }
</script>


    
</body>
</html>
